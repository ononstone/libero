if(!window.iamInitialized){if(!Array.prototype.find){Object.defineProperty(Array.prototype,'find',{value:function(predicate){'use strict';if(this==null){throw new TypeError('Array.prototype.find called on null or undefined');}if(typeof predicate!=='function'){throw new TypeError('predicate must be a function');}var list=Object(this);var length=list.length>>>0;var thisArg=arguments[1];for(var i=0;i!==length;i++){if(predicate.call(thisArg,this[i],i,list)){return this[i];}}return undefined;}});}if(!Array.prototype.filter){Array.prototype.filter=function(fun){'use strict';if(this===void 0||this===null){throw new TypeError();}var t=Object(this);var len=t.length>>>0;if(typeof fun!=='function'){throw new TypeError();}var res=[];var thisArg=arguments.length>=2?arguments[1]:void 0;for(var i=0;i<len;i++){if(i in t){var val=t[i];if(fun.call(thisArg,val,i,t)){res.push(val);}}}return res;};}if(!Array.prototype.includes){Object.defineProperty(Array.prototype,"includes",{enumerable:false,value:function(obj){var newArr=this.filter(function(el){return el==obj;});return newArr.length>0;}});}if(!Object.keys){Object.keys=(function(){'use strict';var hasOwnProperty=Object.prototype.hasOwnProperty,hasDontEnumBug=!({toString:null}).propertyIsEnumerable('toString'),dontEnums=['toString','toLocaleString','valueOf','hasOwnProperty','isPrototypeOf','propertyIsEnumerable','constructor'],dontEnumsLength=dontEnums.length;return function(obj){if(typeof obj!=='function'&&(typeof obj!=='object'||obj===null)){throw new TypeError('Object.keys called on non-object');}var result=[],prop,i;for(prop in obj){if(hasOwnProperty.call(obj,prop)){result.push(prop);}}if(hasDontEnumBug){for(i=0;i<dontEnumsLength;i++){if(hasOwnProperty.call(obj,dontEnums[i])){result.push(dontEnums[i]);}}}return result;};}());}if(!Object.entries)Object.entries=function(obj){var ownProps=Object.keys(obj),i=ownProps.length,resArray=new Array(i);while(i--)resArray[i]=[ownProps[i],obj[ownProps[i]]];return resArray;}
if(!Array.prototype.forEach){Array.prototype.forEach=function(callback){var T,k;if(this==null){throw new TypeError('this is null or not defined');}var O=Object(this);var len=O.length>>>0;if(typeof callback!=='function'){throw new TypeError(callback+' is not a function');}if(arguments.length>1){T=arguments[1];}k=0;while(k<len){var kValue;if(k in O){kValue=O[k];callback.call(T,kValue,k,O);}k++;}};}if(!Object.assign){Object.defineProperty(Object,'assign',{enumerable:false,configurable:true,writable:true,value:function(target,firstSource){'use strict';if(target===undefined||target===null){throw new TypeError('Cannot convert first argument to object');}var to=Object(target);for(var i=1;i<arguments.length;i++){var nextSource=arguments[i];if(nextSource===undefined||nextSource===null){continue;}nextSource=Object(nextSource);var keysArray=Object.keys(Object(nextSource));for(var nextIndex=0,len=keysArray.length;nextIndex<len;nextIndex++){var nextKey=keysArray[nextIndex];var desc=Object.getOwnPropertyDescriptor(nextSource,nextKey);if(desc!==undefined&&desc.enumerable){to[nextKey]=nextSource[nextKey];}}}return to;}});}if(!String.prototype.startsWith){Object.defineProperty(String.prototype,'startsWith',{value:function(search,rawPos){var pos=rawPos>0?rawPos|0:0;return this.substring(pos,pos+search.length)===search;}});}if(!String.prototype.endsWith){String.prototype.endsWith=function(search,this_len){if(this_len===undefined||this_len>this.length){this_len=this.length;}return this.substring(this_len-search.length,this_len)===search;};}if(!String.prototype.replaceAt){String.prototype.replaceAt=function(index,char){var a=this.split("");a[index]=char;return a.join("");}}if(!String.prototype.includes){String.prototype.includes=function(search,start){'use strict';if(typeof start!=='number'){start=0;}if(start+search.length>this.length){return false;}else{return this.indexOf(search,start)!==-1;}};}if(!String.prototype.capitalize){String.prototype.capitalize=function(){return this.replace(/^./,function(match){return match.toUpperCase();});};}(function(){if(typeof window.CustomEvent==="function")return false;function CustomEvent(event,params){params=params||{bubbles:false,cancelable:false,detail:null};var evt=document.createEvent('CustomEvent');evt.initCustomEvent(event,params.bubbles,params.cancelable,params.detail);return evt;}window.CustomEvent=CustomEvent;})();}IOL=window.IOL||{};if(!window.iamInitialized){IOL.adv={classname:"IOL.adv",version:"2.7.3",server:"//www.iolam.it",hostname:window.location.hostname,url:((document.URL)?document.URL:''),referrer:((document.referrer)?document.referrer:false),origin:window.location.origin,domain:"",browser:false,scriptSrc:(document.currentScript)?document.currentScript.src:"undefined",hasFocus:false,pageWidth:document.documentElement.clientWidth||window.innerWidth,device:false,referrerLabel:false,topics:[],started:false,complete:false,mode:'standard',connectionType:"4g",downlink:5,trackingMsg:"",deferredIteration:0,deferredMaxIteration:500,deferredInterval:20,deferredTimer:null,displayEngine:{gpt:true,prebid:false,mgid:false,ketai:false},pubAdsCfg:{gdpr:true,slot:"default",originalSlot:"default",section:"default",prestitial:false,native:false,inread:false,customCriteria:false,profile:true,prebid:true,lazy:false,gptlazy:false,deferredDivId:true,deferredDisplay:false,deferredRun:false,forceHttps:false,dynamicAds:{enable:false},antiMalware:false,},gdpr:{enable:((typeof __tcfapi==='function')?true:false),timer:false,interval:100,maxIteration:(2000/100),timedOut:false,consentString:false,consentGoogle:false,tcfv20:{tcData:false,pipeline:{method:'standard',cmpApi:'iab'},rewriteConsentCookie:{enable:false,name:'localconsent-v2',duration:90}}},profile:{enable:false,up:{remoteHandler:"/service/up",cookie:{name:"up",duration:30},value:{trk:Math.floor((Math.random()*100)+1),up:false,ppid:false,age:false,gender:false,province:false,ext:{seat_keyword:false},isMinor:false},comingFrom:"none",resource:{url:""}},as:{enable:true,cookie:{name:"as",duration:30},value:{s:[],t:[]},comingFrom:"none"}},deviceAccess:{enable:false},syncId:{enable:false,vendor:{amazon:{id:793,enable:false},neustarPG:{id:468,enable:false},neustarLinkage:{id:null,enable:false},groupm:{id:50,enable:false},zeotap:{id:301,enable:false},liveramp:{id:97,enable:false},criteo:{id:91,enable:false}}},videoAds:{"id":false,"reqCounter":0,"status":'ready',"mode":'get',"adUnitPath":false,"adServerUrl":false,"trueview":{"threshold":999999,"param":false},"hb":{"enable":false,"bidders":[],"complete":false,"timedOut":false},"bob":{},"timer":false},test:{enable:false,param:"dctestAdv",cookie:{name:"advTest",duration:1},value:false,paramAdUnitVideo:"iu",adUnitVideo:false,slot:"test"},timer:true&&(typeof window.performance!=='undefined'&&typeof window.performance.now!=='undefined'),debug:{log:{enable:false,id:false},console:{enable:false,handler:"/js/cnsl.js"},tracking:{enable:false,randomInt:0,handler:"/service/trk",percentCustomerBase:1,evnt:{},time:{},adblock:false,attr:[]},},start:function(){var classFunc=IOL.adv.classname+".start";IOL.adv.tools.logger("start function",classFunc);IOL.adv.domain=IOL.adv.tools.getDomain(window.location.host);IOL.adv.browser=IOL.adv.tools.getBrowser();IOL.adv.hasFocus=window.document.hasFocus();IOL.adv.device=IOL.adv.tools.getDevice();IOL.adv.referrerLabel=IOL.adv.tools.getReferrerLabel(IOL.adv.referrer,'other');IOL.adv.topics=IOL.adv.tools.getMetaTag('keywords',',');if(navigator.connection!==undefined){IOL.adv.connectionType=navigator.connection.effectiveType;IOL.adv.downlink=navigator.connection.downlink;switch(IOL.adv.connectionType){case"3g":IOL.adv.headerBidding.hbTimeout=3000;IOL.adv.headerBidding.bidderTimeout=2500;break;case"2g":case"slow-2g":IOL.adv.headerBidding.hbTimeout=6500;IOL.adv.headerBidding.bidderTimeout=6000;IOL.adv.tools.logger("Disable header bidding in case of slow connection",classFunc);IOL.adv.pubAdsCfg.prebid=false;break;default:break;}if(IOL.adv.settings.disableHbOnConnectionType)if(IOL.adv.settings.disableHbOnConnectionType.includes(IOL.adv.connectionType))IOL.adv.pubAdsCfg.prebid=false;IOL.adv.tools.logger("domain: "+IOL.adv.domain+", focus: "+IOL.adv.hasFocus+", connectionType: "+IOL.adv.connectionType+", downlink: "+IOL.adv.downlink+", hbTimeout: "+IOL.adv.headerBidding.hbTimeout+", bidderTimeout: "+IOL.adv.headerBidding.bidderTimeout+", prebid: "+IOL.adv.pubAdsCfg.prebid,classFunc);}if(IOL.adv.pubAdsCfg.section)IOL.adv.pubAdsCfg.section=IOL.adv.pubAdsCfg.section.toLowerCase();IOL.adv.test.value=(IOL.adv.tools.getParameterByName(IOL.adv.test.param))?IOL.adv.tools.getParameterByName(IOL.adv.test.param):IOL.adv.cookie.get(IOL.adv.test.cookie.name,true);if(IOL.adv.test.value!==false){switch(IOL.adv.test.value){case"0":case"off":IOL.adv.cookie.erase(IOL.adv.test.cookie.name);IOL.adv.tools.logger("Disable test on this properties with value: "+IOL.adv.test.value,classFunc);break;default:IOL.adv.test.enable=true;IOL.adv.cookie.set(IOL.adv.test.cookie.name,IOL.adv.test.value,IOL.adv.test.cookie.duration,'/',IOL.adv.domain,true);IOL.adv.pubAdsCfg.slot=IOL.adv.test.slot+((IOL.adv.pubAdsCfg.slot!=='default')?"_"+IOL.adv.pubAdsCfg.slot:"");if(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot]){IOL.adv.pubAdsCfg.originalSlot=IOL.adv.pubAdsCfg.slot;IOL.adv.test.adUnitVideo=(IOL.adv.tools.getParameterByName(IOL.adv.test.paramAdUnitVideo))?IOL.adv.tools.getParameterByName(IOL.adv.test.paramAdUnitVideo):false;if(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads.advideo&&IOL.adv.test.adUnitVideo)IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads.advideo.adUnitPath=IOL.adv.test.adUnitVideo;IOL.adv.tools.logger("Enable test on this properties with value: "+IOL.adv.test.value+", adUnitVideo: "+IOL.adv.test.adUnit,classFunc);}else{IOL.adv.test.enable=false;IOL.adv.pubAdsCfg.slot=IOL.adv.pubAdsCfg.originalSlot;IOL.adv.tools.logger("test slot does not exist, run with provided/default slot: "+IOL.adv.pubAdsCfg.slot,classFunc,"warning");}break;}}IOL.adv.test.enable=IOL.adv.test.enable||(IOL.adv.pubAdsCfg.slot==IOL.adv.test.slot);if(IOL.adv.test.enable)IOL.adv.test.value=(IOL.adv.test.value)?IOL.adv.test.value:"1";if(IOL.adv.pubAdsCfg.prestitial===true){IOL.adv.tools.logger("Prestitial is requested, check frequency cap.",classFunc);if(typeof IOL.adv.settings.ifPrestitial==='function'){if(IOL.adv.settings.ifPrestitial()){IOL.adv.pubAdsCfg.originalSlot=IOL.adv.pubAdsCfg.slot;IOL.adv.pubAdsCfg.slot="prestitial";IOL.adv.tools.logger("Prestitial enabled, override Runtime Slot with \""+IOL.adv.pubAdsCfg.slot+"\"",classFunc);if(IOL.adv.test.enable)IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads.adprestitial.adUnitPath=IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads.adprestitial.adUnitPathTest.replace("%PLACEHOLDER%",IOL.adv.test.value);IOL.adv.tools.logger("prestitial adUnitPath: "+IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads.adprestitial.adUnitPath,classFunc);IOL.adv.pubAdsCfg.prebid=false;IOL.adv.pubAdsCfg.lazy=false;}else{IOL.adv.pubAdsCfg.prestitial=false;IOL.adv.tools.logger("Prestitial disable by ifPrestitial",classFunc);}}else{IOL.adv.pubAdsCfg.prestitial=false;IOL.adv.tools.logger("Prestitial disable, IOL.adv.settings.ifPrestitial function in not implemented but is required.",classFunc);}}IOL.adv.tools.logger("Client  pubAdsCfg: "+JSON.stringify(window.pubAdsCfg),classFunc);IOL.adv.tools.logger("Runtime pubAdsCfg: "+JSON.stringify(IOL.adv.pubAdsCfg),classFunc);if(typeof IOL.adv.settings=='undefined'||IOL.adv.settings.error){IOL.adv.tools.track({e:"error.nameSpaceError",t:Math.floor(performance.now()),lv:"error"});return;}if(!IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot]){IOL.adv.tools.track({e:"error.slotDoesNotExist",t:Math.floor(performance.now()),lv:"error"});return;}window.grumi={cfg:{advs:{},pubIds:{}},key:'4415fe16-b37d-46de-ac5c-69d63c72d5ee'};IOL.adv.headerBidding.supplyChainSid=((IOL.adv.settings.supplyChainSid)?IOL.adv.settings.supplyChainSid:IOL.adv.headerBidding.supplyChainSid);IOL.adv.tools.logger("Apply schainSid: "+IOL.adv.headerBidding.supplyChainSid,classFunc);IOL.adv.tools.asHandler("api");if(IOL.adv.settings.hasOwnProperty("gdpr"))IOL.adv.pubAdsCfg.gdpr=IOL.adv.settings.gdpr;if(IOL.adv.pubAdsCfg.gdpr==false){IOL.adv.settings.tcfv20={enable:false,tcData:false,pipeline:{method:'demand',cmpApi:'iab',callback:function(){IOL.adv.tools.logger("run start without cmp",classFunc);IOL.adv.run();}},rewriteConsentCookie:{enable:false}};}if(IOL.adv.settings.tcfv20){IOL.adv.tools.logger("Override tcfv20",classFunc);IOL.adv.gdpr.tcfv20=IOL.adv.settings.tcfv20;}IOL.adv.tools.cmpHandler(classFunc,function(){switch(IOL.adv.gdpr.tcfv20.pipeline.method){case'demand':IOL.adv.tools.logger("run in demand mode",classFunc);if(IOL.adv.gdpr.tcfv20.pipeline.callback){IOL.adv.tools.logger("run callback",classFunc);IOL.adv.gdpr.tcfv20.pipeline.callback();IOL.adv.tools.logger("end function",classFunc);}break;case'standard':default:IOL.adv.tools.logger("run in standard mode",classFunc);window.__tcfapi('getTCData',2,function(tcData,success){if(success){IOL.adv.gdpr.tcfv20.tcData=tcData;IOL.adv.gdpr.consentString=((IOL.adv.gdpr.tcfv20.tcData.tcString)?IOL.adv.gdpr.tcfv20.tcData.tcString:false);IOL.adv.tools.logger("getTCData success, tcData: "+JSON.stringify(IOL.adv.gdpr.tcfv20.tcData),classFunc);if(IOL.adv.gdpr.consentString&&tcData.eventStatus!=='cmpuishown'){if(IOL.adv.gdpr.tcfv20.rewriteConsentCookie.enable){IOL.adv.cookie.set(IOL.adv.gdpr.tcfv20.rewriteConsentCookie.name,IOL.adv.gdpr.consentString,IOL.adv.gdpr.tcfv20.rewriteConsentCookie.duration);IOL.adv.tools.logger("getTCData, set or refresh consent cookie: "+IOL.adv.gdpr.tcfv20.rewriteConsentCookie.name,classFunc);}IOL.adv.tools.logger("getTCData, start advertising pipeline. tcData.eventStatus: "+tcData.eventStatus,classFunc);IOL.adv.tools.logger("end function",classFunc);IOL.adv.run();}}});window.__tcfapi('addEventListener',2,function(tcData,success){if(success){IOL.adv.tools.logger("addEventListener eventStatus: "+tcData.eventStatus+" ,success: "+success,classFunc);if((tcData.eventStatus==='tcloaded'||tcData.eventStatus==='useractioncomplete')&&tcData.eventStatus!=='cmpuishown'){IOL.adv.gdpr.tcfv20.tcData=tcData;IOL.adv.gdpr.consentString=((IOL.adv.gdpr.tcfv20.tcData.tcString)?IOL.adv.gdpr.tcfv20.tcData.tcString:false);IOL.adv.tools.logger("addEventListener tcData: "+JSON.stringify(IOL.adv.gdpr.tcfv20.tcData),classFunc);if(IOL.adv.gdpr.tcfv20.rewriteConsentCookie.enable&&IOL.adv.gdpr.consentString){IOL.adv.cookie.set(IOL.adv.gdpr.tcfv20.rewriteConsentCookie.name,IOL.adv.gdpr.consentString,IOL.adv.gdpr.tcfv20.rewriteConsentCookie.duration);IOL.adv.tools.logger("addEventListener set or refresh consent cookie: "+IOL.adv.gdpr.tcfv20.rewriteConsentCookie.name,classFunc);}IOL.adv.tools.logger("addEventListener, start advertising pipeline (if is not already running)",classFunc);IOL.adv.tools.logger("end function",classFunc);IOL.adv.run();window.__tcfapi('removeEventListener',2,function(success){IOL.adv.tools.logger("addEventListener removed success: "+success,classFunc);},tcData.listenerId);}else
IOL.adv.tools.logger("addEventListener eventStatus: "+tcData.eventStatus,classFunc);}else{IOL.adv.tools.logger("addEventListener failed, start advertising pipeline anyway",classFunc);IOL.adv.tools.logger("end function",classFunc);IOL.adv.run();}});break;}},function(){IOL.adv.tools.logger("end function",classFunc);IOL.adv.run();},IOL.adv.gdpr.timer,true);},run:function(){var classFunc=IOL.adv.classname+".run";IOL.adv.tools.logger("start function",classFunc);if(IOL.adv.started){IOL.adv.tools.logger("advertising pipeline is already started",classFunc);return;}IOL.adv.tools.logger("start advertising pipeline",classFunc);IOL.adv.started=true;IOL.adv.tools.trkPerf("iamStart",Math.floor(performance.now()));IOL.adv.gdpr.consentGoogle=IOL.adv.tools.getConsent([2,7,9,10],[755]);IOL.adv.tools.logger("consentGoogle is: "+IOL.adv.gdpr.consentGoogle,classFunc);IOL.adv.tools.track({e:"time.start",t:Math.floor(performance.now()),lv:"info"});IOL.adv.tools.logger("start loading 3rd party library depending on cmp",classFunc);Object.keys(IOL.adv.settings.library).forEach(function(key){if(IOL.adv.settings.library[key].enable&&IOL.adv.settings.library[key].hasOwnProperty("gdpr")){IOL.adv.settings.library[key].enable=false;if(typeof IOL.adv.settings.library[key].gdpr=='function')IOL.adv.settings.library[key].enable=IOL.adv.settings.library[key].gdpr();else
IOL.adv.settings.library[key].enable=IOL.adv.tools.getConsent(false,[IOL.adv.settings.library[key].gdpr]);IOL.adv.tools.inject(IOL.adv.settings.library[key]);}});var attributes=[];if(IOL.adv.gdpr.enable){attributes.push("gdprEnable");if(IOL.adv.gdpr.tcfv20.tcData){attributes.push("tcData.defined");if(IOL.adv.gdpr.tcfv20.tcData.hasOwnProperty("purpose")){attributes.push("tcData.purpose.defined");if(IOL.adv.gdpr.tcfv20.tcData.purpose.hasOwnProperty("consents")){attributes.push("tcData.purpose.consents.defined");IOL.adv.deviceAccess.enable=IOL.adv.tools.getConsent([1],false);((IOL.adv.gdpr.tcfv20.tcData.purpose.consents[1])?IOL.adv.gdpr.tcfv20.tcData.purpose.consents[1]:false);IOL.adv.profile.enable=IOL.adv.tools.getConsent([4],false)&&IOL.adv.pubAdsCfg.profile;IOL.adv.syncId.enable=IOL.adv.tools.getConsent([1,2,3,4,5,6,7,8,9,10]);if(IOL.adv.syncId.enable)Object.keys(IOL.adv.syncId.vendor).forEach(function(id){IOL.adv.syncId.vendor[id].enable=IOL.adv.tools.getConsent(false,[IOL.adv.syncId.vendor[id].id])});}else
attributes.push("tcData.purpose.consents.undefined");}else
attributes.push("tcData.purpose.undefined");}else
attributes.push("tcData.undefined");}else
attributes.push("gdprDisable");IOL.adv.tools.trkPerf("iamConsentGoogle"+String(IOL.adv.gdpr.consentGoogle).capitalize(),Math.floor(performance.now()),((attributes.length>0)?attributes:false));IOL.adv.deferredTimer=setInterval(function(){IOL.adv.deferredLibLoading(function(){IOL.adv.tools.logger("end function",classFunc);if(IOL.adv.pubAdsCfg.dynamicAds.enable)IOL.adv.pubAdsCfg.dynamicAds.id.forEach(function(e,idx){IOL.adv.manager.createAds(e,idx);})
IOL.adv.setProfile();IOL.adv.manager.init(function(){IOL.adv.manager.run()});});},IOL.adv.deferredInterval);if(IOL.adv.debug.console.enable)IOL.adv.tools.showConsole();},setProfile:function(){var classFunc=IOL.adv.classname+".setProfile";IOL.adv.tools.logger("Start function",classFunc);IOL.adv.profile.up.cookie.name=((IOL.adv.settings.userProfilingCookieName)?IOL.adv.settings.userProfilingCookieName:IOL.adv.profile.up.cookie.name);if(IOL.adv.profile.enable)IOL.adv.upHandler();else{IOL.adv.delProfile('light');}IOL.adv.tools.logger("end function",classFunc);},upHandler:function(){var classFunc=IOL.adv.classname+".upHandler";IOL.adv.tools.logger("Start function",classFunc);if(IOL.adv.settings.disableUpHandler===true){IOL.adv.tools.logger("upHandler disabled, disableUpHandler: "+IOL.adv.settings.disableUpHandler,classFunc);return;}var upLocal={value:{trk:Math.floor((Math.random()*100)+1),up:"",ppid:{},ts:"0"}};var cookieValue=IOL.adv.cookie.get(IOL.adv.profile.up.cookie.name);if(cookieValue){try{upLocal.value=JSON.parse(decodeURIComponent(cookieValue));if(upLocal.value.ppid==undefined)upLocal.value.ppid={};if(upLocal.value.ext==undefined)upLocal.value.ext={seat_keyword:false};}catch(e){IOL.adv.tools.logger("Error parsing cookie "+IOL.adv.profile.up.cookie.name+", err: "+e.message,classFunc);}IOL.adv.profile.up.value=Object.assign({},upLocal.value);IOL.adv.tools.parseUp('cookie');}IOL.adv.profile.up.resource.url=IOL.adv.server+IOL.adv.profile.up.remoteHandler;IOL.adv.tools.logger("Handle the local user profile calling the remote host: "+IOL.adv.profile.up.resource.url,classFunc);IOL.adv.tools.timer("",IOL.adv.profile.up.resource.url,"start");IOL.adv.tools.remoteCall(IOL.adv.profile.up.resource.url,'d='+IOL.adv.domain+'&a=get&cn='+IOL.adv.profile.up.cookie.name+'&v={"ts":'+upLocal.value.ts+'}',true,function(res){try{IOL.adv.tools.logger("response from remote host: "+res,classFunc);var resObj={cb:""};resObj=JSON.parse(decodeURIComponent(res));switch(resObj.cb){case"set":IOL.adv.tools.logger("set data",classFunc);IOL.adv.cookie.set(IOL.adv.profile.up.cookie.name,JSON.stringify(resObj.v),IOL.adv.profile.up.cookie.duration);IOL.adv.tools.logger("User profile has been written or refreshed on this properties with value:"+res,classFunc);if(resObj.v.hasOwnProperty("ppid"))IOL.adv.profile.up.value.ppid=resObj.v.ppid;if(resObj.v.hasOwnProperty("ext"))IOL.adv.profile.up.value.ext=resObj.v.ext;if(resObj.v.hasOwnProperty("up")){IOL.adv.profile.up.value.up=resObj.v.up;IOL.adv.tools.parseUp('api');}IOL.adv.tools.syncId(true);break;case"del":IOL.adv.tools.logger("delete data",classFunc);IOL.adv.delProfile('light');break;default:IOL.adv.tools.logger("nothing to do",classFunc);IOL.adv.tools.syncId(false);break;}IOL.adv.profile.up.duration=IOL.adv.tools.timer("",IOL.adv.profile.up.resource.url,"partial");IOL.adv.tools.logger("User Profile final object value: "+JSON.stringify(IOL.adv.profile.up.value)+", comingFrom: "+IOL.adv.profile.up.comingFrom,classFunc);}catch(e){IOL.adv.tools.logger("Something goes wrong: "+e.message,classFunc,'error');}});IOL.adv.tools.logger("end function",classFunc);},delProfile:function(mode){var classFunc=IOL.adv.classname+".delProfile";IOL.adv.tools.logger("Start function",classFunc);if(IOL.adv.tools.mEnable("amazonId")&&window.apstag){IOL.adv.tools.logger("Remove amazonId calling apstag.dpa",classFunc);window.apstag.dpa();}if(IOL.adv.cookie.get(IOL.adv.profile.up.cookie.name,true)){IOL.adv.profile.up.value={trk:Math.floor((Math.random()*100)+1),up:false,ppid:false,age:false,gender:false,province:false,ext:{seat_keyword:false}},IOL.adv.cookie.erase(IOL.adv.profile.up.cookie.name);IOL.adv.tools.logger("remove cookie "+IOL.adv.profile.up.cookie.name+" from domain:"+IOL.adv.domain,classFunc);}if(mode=='full'){IOL.adv.tools.logger("Start removing cookie also for www.iolam.it calling handler:"+IOL.adv.server+IOL.adv.profile.up.remoteHandler,classFunc);IOL.adv.tools.remoteCall(IOL.adv.server+IOL.adv.profile.up.remoteHandler,'d='+IOL.adv.domain+'&a=del&cn='+IOL.adv.profile.up.cookie.name,true);IOL.adv.tools.logger("End removing cookie also for www.iolam.it",classFunc);}IOL.adv.tools.logger("end function",classFunc);},getConsentString:function(){var classFunc=IOL.adv.classname+".getConsentString";IOL.adv.tools.logger("return consentString: "+IOL.adv.gdpr.consentString,classFunc);return IOL.adv.gdpr.consentString;},isUserProfileEnable:function(){var classFunc=IOL.adv.classname+".isUserProfileEnable";IOL.adv.tools.logger("return isUserProfileEnable: "+IOL.adv.profile.enable,classFunc);return IOL.adv.profile.enable;},getProfile:function(w){var classFunc=IOL.adv.classname+".getProfile";var ret={};w=(w)?w:"all";switch(w){case"ppid":ret.ppid=(IOL.adv.profile.up.value.ppid)?IOL.adv.profile.up.value.ppid:false;break;case"ppid.iol":if(IOL.adv.profile.up.value.ppid)ret=(IOL.adv.profile.up.value.ppid.iol)?IOL.adv.profile.up.value.ppid.iol:false;else
ret=false;break;case"ppid.gm":if(IOL.adv.profile.up.value.ppid)ret=(IOL.adv.profile.up.value.ppid.gm)?IOL.adv.profile.up.value.ppid.gm:false;else
ret=false;break;case"ppid.rem":if(IOL.adv.profile.up.value.ppid)ret=(IOL.adv.profile.up.value.ppid.rem)?IOL.adv.profile.up.value.ppid.rem:false;else
ret=false;break;case"ppid.zeo":if(IOL.adv.profile.up.value.ppid)ret=(IOL.adv.profile.up.value.ppid.zeo)?IOL.adv.profile.up.value.ppid.zeo:false;else
ret=false;break;case"age":ret.age=(IOL.adv.profile.up.value.age)?IOL.adv.profile.up.value.age:"0";break;case"gender":ret.gender=((IOL.adv.profile.up.value.gender)?IOL.adv.profile.up.value.gender:"0");break;case"province":ret.province=(IOL.adv.profile.up.value.province)?IOL.adv.profile.up.value.province:"0";break;case"consentData":var consentData=IOL.adv.getConsentString();ret.consentData=(consentData!=="")?consentData:false;break;case"audience":ret.audience=(IOL.adv.profile.as.value!==false)?IOL.adv.profile.as.value:false;break;case"all":default:ret.age=(IOL.adv.profile.up.value.age)?IOL.adv.profile.up.value.age:"0";ret.gender=((IOL.adv.profile.up.value.gender)?IOL.adv.profile.up.value.gender:"0");ret.province=(IOL.adv.profile.up.value.province)?IOL.adv.profile.up.value.province:"0";var consentData=IOL.adv.getConsentString();ret.consentData=(consentData!=="")?consentData:false;ret.audience=(IOL.adv.profile.as.value)?IOL.adv.profile.as.value:false;break;}IOL.adv.tools.logger("w: "+w+", r: "+JSON.stringify(ret),classFunc);return ret;},hasConsent:function(){var classFunc=IOL.adv.classname+".hasConsent";var r=false;if(IOL.adv.gdpr.enable)r=((IOL.adv.gdpr.consentString)?true:false);IOL.adv.tools.logger("hasConsent: "+r,classFunc);return r;},deferredLibLoading:function(fn){var classFunc=IOL.adv.classname+".deferredLibLoading";var status=true;IOL.adv.tools.logger("start function",classFunc);IOL.adv.tools.logger("iteration: "+IOL.adv.deferredIteration+", maxIteration: "+IOL.adv.deferredMaxIteration+", interval(ms): "+IOL.adv.deferredInterval,classFunc);if(IOL.adv.deferredIteration<=IOL.adv.deferredMaxIteration){Object.keys(IOL.adv.settings.library).forEach(function(key){IOL.adv.tools.logger(key+" :: live: "+IOL.adv.settings.library[key].live+", enable: "+IOL.adv.settings.library[key].enable+((!IOL.adv.settings.library[key].enable)?", library not in use":""),classFunc);status=status&&(IOL.adv.settings.library[key].live||!IOL.adv.settings.library[key].enable);});if(status){IOL.adv.tools.logger("status true on iteration "+IOL.adv.deferredIteration,classFunc);clearInterval(IOL.adv.deferredTimer);IOL.adv.tools.logger("end function",classFunc);fn();}else{IOL.adv.tools.logger("status false on iteration "+IOL.adv.deferredIteration+", retry...",classFunc);IOL.adv.deferredIteration++;}}else{clearInterval(IOL.adv.deferredTimer);Object.keys(IOL.adv.settings.library).forEach(function(key){if(IOL.adv.settings.library[key].mandatory&&IOL.adv.settings.library[key].live){IOL.adv.tools.logger("iteration finished. The mandatory lib with key "+key+" returning with status: "+IOL.adv.settings.library[key].live,classFunc);status=true;}});if(status){IOL.adv.tools.logger("iteration finished, start with rendering",classFunc);IOL.adv.tools.logger("end function",classFunc);fn();}else
IOL.adv.tools.logger("status false, failed on iteration: "+IOL.adv.deferredIteration+", deferredMaxIteration: "+IOL.adv.deferredMaxIteration,"error");}},refreshSlot:function(id,callback,pipeline){var classFunc=IOL.adv.classname+".refreshSlot";var pipeline=(pipeline)?pipeline:'display';var interval=50;var i=setInterval(function(){if(IOL.adv.complete){IOL.adv.tools.logger(pipeline+" :: refreshSlot requested and IOL.adv.complete is true, run refreshSlotRun",classFunc);clearInterval(i);IOL.adv.refreshSlotRun(id,callback,pipeline);}else
IOL.adv.tools.logger(pipeline+" :: refreshSlot requested but IOL.adv.complete is false, please wait...",classFunc);},interval);},refreshSlotRun:function(id,callback,pipeline){var classFunc=IOL.adv.classname+".refreshSlotRun";IOL.adv.tools.logger("Start function",classFunc);IOL.adv.complete=false;if(pipeline=='display')IOL.adv.mode='refresh';if(IOL.adv.pubAdsCfg.deferredDisplay)IOL.adv.pubAdsCfg.deferredDisplay=false;IOL.adv.manager.refreshSlotsContainer={requested:[],valid:[],slots:[],ads:{},headerBidding:{prebidjs:{adUnits:[]}}};if(id){IOL.adv.manager.refreshSlotsContainer.requested=id.split(',').filter(function(e){if(e)return e;});}else
Object.keys(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads).forEach(function(key){IOL.adv.manager.refreshSlotsContainer.requested.push(key);});IOL.adv.manager.refreshSlotsContainer.valid=IOL.adv.manager.refreshSlotsContainer.requested.filter(function(key){if(!IOL.adv.manager.slotsContainer[key]){IOL.adv.tools.logger("Refresh disable, "+key+" is not in slotsContainer.",classFunc);return false;}var ad=IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[key];var refresh=true;if(ad.refresh){if((Date.now()-ad.refresh.ts)>ad.refresh.gap){ad.refresh.ts=Date.now();}else{refresh=false;IOL.adv.tools.logger("Refresh disable, "+key+" refresh gap is not reached yet",classFunc);}}else{refresh=false;IOL.adv.tools.logger("Refresh disable, "+key+" this ads is not compliant for refresh.",classFunc);}return ad.mediaType==pipeline&&refresh;});if(pipeline=='video'&&IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads.advideo)IOL.adv.manager.refreshSlotsContainer.valid.push('advideo');IOL.adv.tools.logger("Requested slots: "+IOL.adv.manager.refreshSlotsContainer.requested.toString()+". Valid slots to refresh: "+IOL.adv.manager.refreshSlotsContainer.valid.toString(),classFunc);if(IOL.adv.manager.refreshSlotsContainer.valid.length==0){IOL.adv.complete=true;IOL.adv.tools.logger("Refresh disable no ads to refresh.",classFunc);return;}IOL.adv.manager.refreshSlotsContainer.valid.forEach(function(key){if(IOL.adv.manager.slotsContainer[key]){IOL.adv.manager.refreshSlotsContainer.slots.push(IOL.adv.manager.slotsContainer[key]);}});Object.keys(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads).forEach(function(key){var ad=IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[key];if(IOL.adv.manager.refreshSlotsContainer.valid.indexOf(key)>=0){IOL.adv.manager.refreshSlotsContainer.ads[key]=ad;if(typeof ad.fnBeforeRefresh=="function"){IOL.adv.tools.logger(key+" fnBeforeRefresh: run function before refresh.",classFunc);ad.fnBeforeRefresh();}}});if(typeof IOL.adv.settings.prebidjs!=='undefined')Object.keys(IOL.adv.manager.refreshSlotsContainer.ads).forEach(function(key){var ad=IOL.adv.manager.refreshSlotsContainer.ads[key];IOL.adv.settings.prebidjs.adUnits.filter(function(e){if(e.code==this.code){IOL.adv.manager.refreshSlotsContainer.headerBidding.prebidjs.adUnits.push(e);return true;}},{code:ad.divId});if(ad.mgid){IOL.adv.tools.logger(ad.divId+": mgid found",classFunc);IOL.adv.tools.displayMgid(ad,"asFirst",function(){return!IOL.adv.gdpr.consentGoogle&&(ad.mgid.mode=="asFirst"||!IOL.adv.headerBidding.enable)},function(){IOL.adv.tools.logger(id+": disable hb, use mgid for this ads",classFunc);ad.bidAmazon=false;IOL.adv.manager.refreshSlotsContainer.headerBidding.prebidjs.adUnits.pop();},classFunc);}if(ad.ketai){IOL.adv.tools.logger(ad.divId+": ketai found",classFunc);IOL.adv.tools.displayKetai(ad,"asFirst",function(){return!IOL.adv.gdpr.consentGoogle&&!IOL.adv.pubAdsCfg.deferredDisplay&&(ad.ketai.mode=="asFirst"||!IOL.adv.headerBidding.enable)},function(){IOL.adv.tools.logger(id+": disable hb, use ketai for this ads",classFunc);ad.bidAmazon=false;IOL.adv.manager.refreshSlotsContainer.headerBidding.prebidjs.adUnits.pop();},classFunc);}});IOL.adv.tools.logger("Start headerBidding.init",classFunc);IOL.adv.headerBidding.init(IOL.adv.manager.refreshSlotsContainer.ads,IOL.adv.manager.refreshSlotsContainer.headerBidding.prebidjs.adUnits,function(){IOL.adv.headerBidding.run(callback)},function(){if(!IOL.adv.headerBidding.enable)if(IOL.adv.manager.refreshSlotsContainer.slots.length>0){IOL.adv.tools.logger("Refresh slots using standard mode",classFunc);IOL.adv.tools.displayAds({slotContainer:IOL.adv.manager.refreshSlotsContainer.slots});try{if(typeof IamCallbackOnComplete==="function"){IOL.adv.tools.logger("Hook IamCallbackOnComplete. HeaderBidding is disable",classFunc);IamCallbackOnComplete();}}catch(e){}}if(callback){callback();IOL.adv.tools.logger("Run callback "+callback,classFunc);}},pipeline);IOL.adv.tools.logger("End function.",classFunc);},createAds:function(id,divId){var classFunc=IOL.adv.classname+".createAds";var interval=100;var callback=(callback)?callback:false;IOL.adv.mode="createads";if(!IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].dynamic){IOL.adv.tools.logger("dynamic slot is non configured for namespace: "+IOL.adv.settings.ns,classFunc);return;if(!IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].dynamic[id]){IOL.adv.tools.logger(id+" is not a defined ads dynamic slot",classFunc);return;}}var divIds=(typeof divId=='string')?Array(divId):divId;divIds.forEach(function(divId){var adId=id+'_'+divId;if(IOL.adv.manager.slotsContainer[adId]){IOL.adv.tools.logger(adId+" has been already created, so refresh it",classFunc);if(IOL.adv.settings.prebidjs.onDemandAdUnits){if(IOL.adv.settings.prebidjs.onDemandAdUnits[id]){IOL.adv.tools.logger("prebid dynamic code: "+IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[adId].divId,classFunc);IOL.adv.settings.prebidjs.onDemandAdUnits[id].code=IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[adId].divId;IOL.adv.settings.prebidjs.adUnits.push(IOL.adv.settings.prebidjs.onDemandAdUnits[id]);}}IOL.adv.refreshSlot(adId);return;}var adSkeleton=IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].dynamic[id];var i=setInterval(function(){if(IOL.adv.complete){IOL.adv.tools.logger("advertising pipeline complete: "+IOL.adv.complete,classFunc);clearInterval(i);IOL.adv.complete=false;var onDemandSlot="on-demand-ads";if(IOL.adv.test.enable)onDemandSlot="test_".concat(onDemandSlot);IOL.adv.pubAdsCfg.slot=onDemandSlot;IOL.adv.tools.logger("Apply new slot: "+IOL.adv.pubAdsCfg.slot,classFunc);IOL.adv.pubAdsCfg.deferredDivId=false;IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot]={};IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot]={ads:{}};IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[adId]={};IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[adId].mediaType='display';IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[adId].divIdReady=true;IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[adId].divId=divId;IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[adId].adUnitPath=adSkeleton.adUnitPath;IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[adId].size=adSkeleton.size;IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[adId].sizeMapping=adSkeleton.sizeMapping;IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[adId].refresh=adSkeleton.refresh;IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[adId].onRenderEnded=adSkeleton.onRenderEnded;IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[adId].bidAmazon=adSkeleton.bidAmazon;IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[adId].optional=adSkeleton.optional;IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[adId].setCollapseEmptyDiv=adSkeleton.setCollapseEmptyDiv;IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[adId].forceSafeFrame=adSkeleton.forceSafeFrame;IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[adId].fnBefore=adSkeleton.fnBefore;IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[adId].fnAfter=adSkeleton.fnAfter;IOL.adv.tools.logger("Create ads on demand with id: "+adId+", divId: "+divId,classFunc);IOL.adv.manager.originalSlotsContainer=Object.assign({},IOL.adv.manager.slotsContainer);IOL.adv.manager.slotsContainer=[];IOL.adv.tools.logger("originalSlotsContainer: "+IOL.adv.manager.originalSlotsContainer,classFunc);if(IOL.adv.settings.prebidjs.adUnits){IOL.adv.settings.prebidjs.originalAdUnits=IOL.adv.settings.prebidjs.adUnits;IOL.adv.settings.prebidjs.adUnits=[];}if(IOL.adv.settings.prebidjs.onDemandAdUnits){if(IOL.adv.settings.prebidjs.onDemandAdUnits[id]){IOL.adv.tools.logger("prebid dynamic code: "+IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[adId].divId,classFunc);IOL.adv.settings.prebidjs.onDemandAdUnits[id].code=IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[adId].divId;IOL.adv.settings.prebidjs.adUnits.push(IOL.adv.settings.prebidjs.onDemandAdUnits[id]);}}IOL.adv.manager.init(function(){IOL.adv.manager.run()});googletag.pubads().addEventListener('slotRequested',function(event){if(event.slot.getSlotElementId()==divId){IOL.adv.tools.logger("slotRequested for "+divId+" triggered.",classFunc);IOL.adv.tools.logger("Revert slot and prebid config, extend IOL.adv.manager.slotsContainer with on demand slot",classFunc);IOL.adv.pubAdsCfg.slot=IOL.adv.pubAdsCfg.originalSlot;if(!IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[adId])IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[adId]=IOL.adv.settings.slots[onDemandSlot].ads[adId];if(IOL.adv.settings.prebidjs.originalAdUnits)IOL.adv.settings.prebidjs.adUnits=IOL.adv.settings.prebidjs.originalAdUnits;IOL.adv.manager.slotsContainer=IOL.adv.tools.extend(IOL.adv.manager.slotsContainer,IOL.adv.manager.originalSlotsContainer);if(callback){IOL.adv.tools.logger("A callback has been requested, run: "+callback,classFunc);callback();}}});}else
IOL.adv.tools.logger("advertising pipeline not completed...",classFunc);},interval);});},displaySlot:function(id,callback){var classFunc=IOL.adv.classname+".displaySlot";var slotsContainer={requested:[],slots:[],};if(IOL.adv.pubAdsCfg.deferredDisplay)IOL.adv.pubAdsCfg.deferredDisplay=false;if(id){slotsContainer.requested=id.split(',').filter(function(e){if(e)return e;});}else
Object.keys(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads).forEach(function(key){slotsContainer.requested.push(key);});IOL.adv.tools.logger("Requested slots : "+slotsContainer.requested.toString(),classFunc);slotsContainer.requested.forEach(function(key){if(IOL.adv.manager.slotsContainer[key]){slotsContainer.slots.push(IOL.adv.manager.slotsContainer[key]);IOL.adv.tools.logger(key+" is a valid slot",classFunc);}else
IOL.adv.tools.logger(key+" is not a valid slot",classFunc);});if(IOL.adv.headerBidding.enable)IOL.adv.tools.displayAds({slotContainer:slotsContainer.slots});else
IOL.adv.tools.displayAds({slotId:IOL.adv.manager.lastSlotIdReady});if(callback){IOL.adv.tools.logger("Run callback "+callback,classFunc);callback();}},destroySlot:function(s){var classFunc=IOL.adv.classname+".destroySlot";IOL.adv.tools.logger("Start function",classFunc);IOL.adv.tools.logger("destroySlot request: "+s,classFunc);if(s){var aSlots=s.split(',');aSlots.forEach(function(v){if(IOL.adv.manager.slotsContainer[v]){IOL.adv.tools.logger("start destroySlot for slot: "+v,classFunc);googletag.destroySlots([IOL.adv.manager.slotsContainer[v]]);delete IOL.adv.manager.slotsContainer[v];}else
IOL.adv.tools.logger("slot "+v+" does not exist",classFunc);});}else{IOL.adv.tools.logger("destroySlot for all slots",classFunc);googletag.destroySlots();}IOL.adv.tools.logger("End function",classFunc);},clearSlot:function(s){var classFunc=IOL.adv.classname+".clearSlot";IOL.adv.tools.logger("Start function",classFunc);IOL.adv.tools.logger("clearSlot request: "+s,classFunc);if(s){var aSlots=s.split(',');aSlots.forEach(function(v){if(IOL.adv.manager.slotsContainer[v]){IOL.adv.tools.logger("start clear for slot: "+v,classFunc);googletag.pubads().clear([IOL.adv.manager.slotsContainer[v]]);}else
IOL.adv.tools.logger("slot "+v+" does not exist",classFunc);});}else{IOL.adv.tools.logger("destroySlot for all slots",classFunc);googletag.pubads().clear();}IOL.adv.tools.logger("End function",classFunc);},getAdUnitPath:function(id,provider,initiator){var classFunc=IOL.adv.classname+".getAdUnitPath,"+initiator;var r=false;provider=(provider)?provider.toLowerCase():"";try{if(id)if(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id]){r=(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id].adUnitPathOverride&&IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id].adUnitPathOverride[provider])?IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id].adUnitPathOverride[provider]:IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id].adUnitPath;if(IOL.adv.pubAdsCfg.section=='')IOL.adv.pubAdsCfg.section='default';if(IOL.adv.pubAdsCfg.section&&IOL.adv.settings.sectionMap)r=(IOL.adv.settings.sectionMap[IOL.adv.pubAdsCfg.section])?r.replace("%SECTION%",IOL.adv.settings.sectionMap[IOL.adv.pubAdsCfg.section]):r.replace("%SECTION%",IOL.adv.settings.sectionMap["default"]);if(typeof window._ABTestingTrack!=="undefined"&&!/test[A|B|C]$/.test(r))r+="/test"+window._ABTestingTrack.toUpperCase();if(IOL.adv.test.enable)r=r.replace("%PLACEHOLDER%",IOL.adv.test.value);}}catch(e){}IOL.adv.tools.logger("adUnitPath for ad: "+id+", provider: "+provider+" is: "+r,classFunc);return r;},setAdUnitPath:function(id,value){var classFunc=IOL.adv.classname+".setAdUnitPath";try{if(id&&value)if(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id])IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id].adUnitPath=value;}catch(e){return false;}IOL.adv.tools.logger("adUnitPath for ad: "+IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id].adUnitPath,classFunc);return true;},setAdUnitContent:function(id,o){var classFunc=IOL.adv.classname+".setAdUnitContent";IOL.adv.tools.logger("set content for "+id+": "+o,classFunc);try{if(id&&o){if(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id]){IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id].content=o;return true;}else{IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id].content=false;return false;}}}catch(e){return false;}},setAdSliderContent:function(o){var classFunc=IOL.adv.classname+".setAdSliderContent";IOL.adv.tools.logger("try to set adslider content: "+JSON.stringify(o),classFunc);try{if(o&&IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].sliderContainer){o.adunit=o.adunit.split('/').pop();IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].sliderContainer.content.push(o);IOL.adv.tools.logger("adslider content set",classFunc);return true;}}catch(e){return false;}},setUrl:function(u){var classFunc=IOL.adv.classname+".setUrl";IOL.adv.url=u;IOL.adv.tools.logger("IOL.adv.url: "+IOL.adv.url,classFunc);},setVideoAdsTrueViewThreshold:function(v){var classFunc=IOL.adv.classname+".setVideoAdsTrueViewThreshold";if(v)IOL.adv.videoAds.trueview.threshold=v;IOL.adv.tools.logger("trueview.threshold: "+IOL.adv.videoAds.trueview.threshold,classFunc);},getAdUnitContent:function(id){var classFunc=IOL.adv.classname+".getAdUnitContent";var r=false;try{if(id)if(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id].content)r=IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id].content;}catch(e){}IOL.adv.tools.logger("get content for "+id+": "+r,classFunc);return r;},getVideoAds:function(provider,callback,options){var classFunc=IOL.adv.classname+".getVideoAds";IOL.adv.tools.trkVideo({evnt:"iam_getvideoads_request",reload:IOL.adv.videoAds.bob.reload,count:IOL.adv.videoAds.reqCounter+1,time:Math.floor(performance.now())});if(IOL.adv.videoAds.reqCounter==0&&!IOL.adv.gdpr.consentString&&IOL.adv.pubAdsCfg.gdpr!==false){IOL.adv.tools.cmpHandler(classFunc,function(){window.__tcfapi('addEventListener',2,function(tcData,success){if(success){IOL.adv.tools.logger("addEventListener eventStatus: "+tcData.eventStatus+" ,success: "+success,classFunc);if((tcData.eventStatus==='tcloaded'||tcData.eventStatus==='useractioncomplete')&&tcData.eventStatus!=='cmpuishown'){IOL.adv.gdpr.tcfv20.tcData=tcData;IOL.adv.gdpr.consentString=((IOL.adv.gdpr.tcfv20.tcData.tcString)?IOL.adv.gdpr.tcfv20.tcData.tcString:false);IOL.adv.tools.logger("addEventListener tcData: "+JSON.stringify(IOL.adv.gdpr.tcfv20.tcData),classFunc);IOL.adv.tools.logger("addEventListener, runGetVideoAds start",classFunc);IOL.adv.runGetVideoAds(provider,callback,options);window.__tcfapi('removeEventListener',2,function(success){IOL.adv.tools.logger("addEventListener removed success: "+success,classFunc);},tcData.listenerId);}else
IOL.adv.tools.logger("addEventListener eventStatus: "+tcData.eventStatus,classFunc);}else{IOL.adv.tools.logger("addEventListener failed",classFunc);IOL.adv.tools.logger("addEventListener, runGetVideoAds start anyway",classFunc);IOL.adv.runGetVideoAds(provider,callback,options);}});},function(){IOL.adv.runGetVideoAds(provider,callback,options);},IOL.adv.videoAds.timer,true);}else{IOL.adv.tools.logger("runGetVideoAds start",classFunc);IOL.adv.runGetVideoAds(provider,callback,options);}},runGetVideoAds:function(provider,callback,options){var classFunc=IOL.adv.classname+".runGetVideoAds";var interval=50;var id="advideo";var provider=(provider)?provider:"";var options=(options)?options:false;IOL.adv.videoAds.reqCounter++;if(!IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads.advideo){IOL.adv.tools.logger("advideo slot is not defined",classFunc);IOL.adv.videoAds.status='error';IOL.adv.tools.trkVideo({evnt:"iam_getvideoads_error",reload:IOL.adv.videoAds.bob.reload,count:IOL.adv.videoAds.reqCounter,time:Math.floor(performance.now())});if(callback){IOL.adv.tools.logger("Requested callback "+callback,classFunc);callback(IOL.adv.videoAds);return;}else
return IOL.adv.videoAds;}else
var ad=IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads.advideo;if(ad.maxRequest)if(IOL.adv.videoAds.reqCounter>ad.maxRequest.value){if(ad.maxRequest.callback){IOL.adv.tools.logger("max requests exceeded, run: "+ad.maxRequest.callback,classFunc);ad.maxRequest.callback();return;}}if(!IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads.advideo.divIdReady)IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads.advideo.divIdReady=true;switch(IOL.adv.videoAds.reqCounter){case 1:IOL.adv.videoAds.mode='standard';IOL.adv.headerBidding.supplyChainSid=((IOL.adv.settings.supplyChainSid)?IOL.adv.settings.supplyChainSid:IOL.adv.headerBidding.supplyChainSid);IOL.adv.tools.logger("Apply schainSid: "+IOL.adv.headerBidding.supplyChainSid,classFunc);if(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].fnInit){if(!IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].fnInitDone){IOL.adv.tools.logger("Run fnInit on slot: "+IOL.adv.pubAdsCfg.slot+" using function: "+IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].fnInit,classFunc);IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].fnInitDone=true;eval(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].fnInit);}}if(ad.fnBefore){IOL.adv.tools.logger(id+" run fnBefore",classFunc);eval(ad.fnBefore);}break;default:IOL.adv.videoAds.mode='refresh';break;}IOL.adv.refreshSlot(id,false,'video');var i=setInterval(function(){if(!IOL.adv.headerBidding.enable||IOL.adv.headerBidding.requestManager.adServerRequestSent){IOL.adv.tools.logger("HeaderBidding "+((!IOL.adv.headerBidding.enable)?"disable":"done"),classFunc);clearInterval(i);IOL.adv.complete=true;IOL.adv.createVideoAds(provider,callback,options,ad);if(IOL.adv.videoAds.reqCounter==1){if(ad.fnAfter){IOL.adv.tools.logger(id+" run fnAfter",classFunc);eval(ad.fnAfter);}}if(typeof IamCallbackVideoAdsOnComplete==="function"){IOL.adv.tools.logger("Hook IamCallbackVideoAdsOnComplete in getVideoAds",classFunc);IamCallbackVideoAdsOnComplete();}}else
IOL.adv.tools.logger("HeaderBidding is still running...",classFunc);},interval);},createVideoAds:function(provider,callback,options,ad){var classFunc=IOL.adv.classname+".createVideoAds";var prefixAdServerUrl='https://pubads.g.doubleclick.net/gampad/ads?';IOL.adv.videoAds.id=IOL.adv.tools.randomId();IOL.adv.videoAds.status='ready';IOL.adv.videoAds.adServerUrl=false;IOL.adv.videoAds.hb={'enable':false,'bidders':[],'complete':false,'timedOut':false};if(typeof IOL.adv.settings.overrideProvider=='function'){overrideProvider=IOL.adv.settings.overrideProvider();if(overrideProvider){provider=overrideProvider;IOL.adv.tools.logger("Provider overrided with: "+overrideProvider,classFunc);}}var up=IOL.adv.getProfile();IOL.adv.videoAds.trueview.param=((IOL.adv.videoAds.reqCounter<=IOL.adv.videoAds.trueview.threshold)?'&trueview=yes':'&trueview=no');if(options&&ad.optionalFunction){if(ad.optionalFunction['function']){if(ad.optionalFunction['function'].f){IOL.adv.tools.logger("Run optional function: "+ad.optionalFunction['function'].f,classFunc);ad.optionalFunction['function'].f(ad,options);}}else
IOL.adv.tools.logger("Optional function not defined",classFunc);}IOL.adv.videoAds.adUnitPath=IOL.adv.getAdUnitPath('advideo',provider,classFunc);IOL.adv.tools.logger("Requested provider: "+provider+", adUnitPath: "+IOL.adv.videoAds.adUnitPath,classFunc);var bs=false;if(IOL.adv.pubAdsCfg.customCriteria)if(IOL.adv.pubAdsCfg.customCriteria.adv_bs)bs=IOL.adv.pubAdsCfg.customCriteria.adv_bs.replace(/\|/g,",");IOL.adv.videoAds.adServerUrl=prefixAdServerUrl+'sz=640x480&ciu_szs=&unviewed_position_start=1&gdfp_req=1&impl=s&env=vp&output=vast'+'&iu='+encodeURIComponent(IOL.adv.videoAds.adUnitPath)+'&url=[referrer_url]&correlator=[timestamp]'+'&description_url='+encodeURIComponent(IOL.adv.url)+'&npa='+(!IOL.adv.profile.enable?'1':'0')+'&tfcd='+((IOL.adv.profile.up.value.isMinor)?'1':'0')+'&cust_params='+((!IOL.adv.profile.up.value.isMinor)?encodeURIComponent('adv_sso1='+up.age+'&adv_sso2='+up.gender):'')+encodeURIComponent((up.audience.s.length>0&&IOL.adv.profile.enable&&!IOL.adv.profile.up.value.isMinor)?'&1plusx='+up.audience.s.join(','):'')+encodeURIComponent((up.audience.t.length>0)?'&ctx1plusx='+up.audience.t.join(','):'')+((IOL.adv.videoAds.trueview.param)?encodeURIComponent(IOL.adv.videoAds.trueview.param):'')+((IOL.adv.topics)?encodeURIComponent('&adv_topics='+IOL.adv.topics.join(',')):'')+((bs)?encodeURIComponent('&adv_bs='+bs):'')+((IOL.adv.referrerLabel)?encodeURIComponent('&adv_referrer='+IOL.adv.referrerLabel):'')+((IOL.adv.headerBidding.prebidjs.enable)?encodeURIComponent("&pbjs_version="+IOL.adv.headerBidding.prebidjs.version):'')+((IOL.adv.pubAdsCfg.native)?encodeURIComponent("&native="+IOL.adv.pubAdsCfg.native):'')+encodeURIComponent('&us_ua='+((IOL.adv.profile.up.value.isMinor)?'true':'false'))+encodeURIComponent('&npa='+(!IOL.adv.profile.enable?'1':'0'))+IOL.adv.headerBidding.getAmazonVideoBid()+((ad.adServerUrlAppendCustomParams)?encodeURIComponent(ad.adServerUrlAppendCustomParams):'')+((up.consentData)?encodeURIComponent('&gdpr=1&gdpr_consent='+up.consentData):'')+((IOL.adv.headerBidding.supplyChainSid)?encodeURIComponent('&schainsid='+IOL.adv.headerBidding.supplyChainSid):'');if(ad.adServerUrlAppendParams)IOL.adv.videoAds.adServerUrl+=ad.adServerUrlAppendParams;if(IOL.adv.headerBidding.prebidjs.enable){var videoAdUnit=IOL.adv.settings.prebidjs.adUnits.find(IOL.adv.headerBidding.findAdunitByMediaType,{'mediaType':'video'});if(videoAdUnit){IOL.adv.tools.logger("Add pbjs bids on video adServerUrl",classFunc);IOL.adv.videoAds.adServerUrl=pbjs.adServers.dfp.buildVideoUrl({adUnit:videoAdUnit,url:IOL.adv.videoAds.adServerUrl,output:'vast'});IOL.adv.tools.logger("Final pbjs video url: "+IOL.adv.videoAds.adServerUrl,classFunc);}}IOL.adv.videoAds.hb.enable=IOL.adv.headerBidding.enable;IOL.adv.videoAds.hb.bidders=(IOL.adv.headerBidding.enable)?IOL.adv.headerBidding.bidders:[];IOL.adv.videoAds.hb.complete=IOL.adv.headerBidding.requestManager.adServerRequestSent||!IOL.adv.headerBidding.enable;IOL.adv.videoAds.hb.timedOut=IOL.adv.headerBidding.requestManager.timedOut;IOL.adv.videoAds.status='complete';IOL.adv.tools.logger("Video Ads: "+JSON.stringify(IOL.adv.videoAds),classFunc);IOL.adv.tools.trkVideo({evnt:"iam_getvideoads_response",reload:IOL.adv.videoAds.bob.reload,count:IOL.adv.videoAds.reqCounter,time:Math.floor(performance.now())});if(callback){IOL.adv.tools.logger("Requested callback "+callback,classFunc);callback(IOL.adv.videoAds);}return;},getVideoAdServerUrl:function(){return IOL.adv.videoAds.adServerUrl;}}}if(!window.iamInitialized){IOL.adv.tools={classname:"IOL.adv.tools",timerContainer:[],logger:function(msg,cFunc,lvl){if(!IOL.adv.debug.log.enable)return;var e="IAM::"+IOL.adv.version+((IOL.adv.settings.ns)?"::"+IOL.adv.settings.ns:"")+"::"+IOL.adv.debug.log.id;var lvl=(lvl)?lvl:"info";var m=new Date();var d=m.getUTCFullYear()+"/"+("0"+(m.getUTCMonth()+1)).slice(-2)+"/"+("0"+m.getUTCDate()).slice(-2)+" "+("0"+m.getUTCHours()).slice(-2)+":"+("0"+m.getUTCMinutes()).slice(-2)+":"+("0"+m.getUTCSeconds()).slice(-2)+"."+this.digPadding((m.getUTCMilliseconds()),3);switch(lvl){case"error":console.error("%c"+e+"%c :: ERROR :: "+d+" :: "+cFunc+" :: "+msg,"display: inline-block; color: #fff; background: red; padding: 1px 4px; border-radius: 3px; font-size: x-small","background-color:white; color: #000; font-size: x-small");break;case"warning":console.warn("%c"+e+"%c :: INFO :: "+d+" :: "+cFunc+" :: "+msg,"display: inline-block; color: #fff; background: #3b88c3; padding: 1px 4px; border-radius: 3px; font-size: x-small","background-color:#fff; font-size: x-small");break;case"info":default:console.info("%c"+e+"%c :: INFO :: "+d+" :: "+cFunc+" :: "+msg,"display: inline-block; color: #fff; background: #3b88c3; padding: 1px 4px; border-radius: 3px; font-size: x-small","background-color:#fff; font-size: x-small");break;}},timer:function(classFunc,tag,action){if(!IOL.adv.timer)return;var label=classFunc+"."+tag;if(action=="start"||action=="stop")IOL.adv.tools.timerContainer[label+action]=performance.now();if(action=="partial"){var el=Math.floor(performance.now()-IOL.adv.tools.timerContainer[label+"start"]);IOL.adv.tools.timerContainer[label+action]=el;return el;}if(action=="elapsed")return Math.floor(performance.now());},showConsole:function(fn){if(document.getElementById("3eRbq4M8vffvBuyT")){document.getElementById("3eRbq4M8vffvBuyT").remove();}IOL.adv.tools.loadJs(IOL.adv.server+IOL.adv.debug.console.handler);},loadJs:function(f,handleOnError,handleOnLoad,attribute){if(typeof attribute=="string")attribute={"id":attribute};var head=document.head||document.documentElement.childNodes[0];var e=document.createElement('script');e.async=true;e.type='text/javascript';if(typeof attribute=="object")Object.keys(attribute).forEach(function(k){e.setAttribute(k,attribute[k]);});if(handleOnError)e.onerror=handleOnError;if(handleOnLoad)e.onload=handleOnLoad;var useSSL='https:'==document.location.protocol;e.src=((useSSL||IOL.adv.pubAdsCfg.forceHttps)?'https:':'http:')+f;head.appendChild(e);},documentReady:function(fn){if(document.readyState!='loading'){fn();}else if(document.addEventListener){document.addEventListener('DOMContentLoaded',fn);}else{document.attachEvent('onreadystatechange',function(){if(document.readyState!='loading')fn();});}},deferredDivIdReady:function(fn){var classFunc=IOL.adv.tools.classname+".deferredDivIdReady";IOL.adv.manager.divIdReady=IOL.adv.tools.divIdsReady(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads,IOL.adv.manager.divIdReadyList);IOL.adv.tools.logger("document.readyState:"+document.readyState+", divIdReady:"+IOL.adv.manager.divIdReady+", deferredMaxIteration:"+IOL.adv.manager.deferredMaxIteration+", deferredIteration: "+IOL.adv.manager.deferredIteration+", deferredInterval (ms.):"+IOL.adv.manager.deferredInterval,classFunc);if(IOL.adv.manager.deferredIteration<=IOL.adv.manager.deferredMaxIteration){if(IOL.adv.manager.divIdReady||document.readyState!=='loading'){IOL.adv.tools.logger("deferredDivIdReady status: true, ready ads: ["+IOL.adv.manager.divIdReadyList+"], iteration: "+IOL.adv.manager.deferredIteration,classFunc);clearInterval(IOL.adv.manager.deferredTimer);fn();}else{IOL.adv.manager.deferredIteration++;IOL.adv.tools.logger("status false, retry:: deferredMaxIteration:"+IOL.adv.manager.deferredMaxIteration+" deferredIteration: "+IOL.adv.manager.deferredIteration,classFunc);}}else{clearInterval(IOL.adv.manager.deferredTimer);fn();IOL.adv.tools.track({e:"error.divIdNotReady",div:ad.divId,t:Math.floor(performance.now()),lv:"warning"});IOL.adv.tools.logger("status false, failed:: deferredMaxIteration:"+IOL.adv.manager.deferredMaxIteration+" deferredIteration: "+IOL.adv.manager.deferredIteration,classFunc);}},divIdsReady:function(ads,aRes){var classFunc=IOL.adv.tools.classname+".divIdsReady";var aRes=(aRes)?aRes:[];var ready=true;Object.keys(ads).forEach(function(id){var ad=ads[id];var optional=(ad.optional===true)?true:false;if(!optional&&ad.divId!==undefined){ad.divIdReady=IOL.adv.tools.divIdReady(ad);ready=ready&&ad.divIdReady;if(ready)if(!aRes.includes(ad.divId))aRes.push(ad.divId);IOL.adv.tools.logger("divId:"+ad.divId+", Optional: "+ad.optional+", Ready: "+ad.divIdReady,classFunc);}else{IOL.adv.tools.logger("divId:"+ad.divId+", Optional: "+ad.optional+", Ready: check is disable for optional ads container",classFunc);}});return ready;},divIdReady:function(ad,getEl){var classFunc=IOL.adv.tools.classname+".divIdReady";var getEl=(getEl)?getEl:false;var ready=false;if(ad.divId){if(typeof ad.divId==='string'){if(getEl)ready=document.getElementById(ad.divId);else
ready=document.getElementById(ad.divId)!==null;}else{var nL=document.querySelectorAll(ad.divId.regex);ready=(nL.length>0)?true:false;}IOL.adv.tools.logger("divId:"+ad.divId+" ready: "+ready,classFunc);}return ready;},divIdSwap:function(width,ads,id){var classFunc=IOL.adv.tools.classname+".divIdSwap";if(width>=ads.divIdSwap.minW&&width<ads.divIdSwap.maxW){IOL.adv.tools.logger(id+" :: start swap ads container",classFunc);if(IOL.adv.settings.prebidjs)if(IOL.adv.settings.prebidjs.adUnits)IOL.adv.settings.prebidjs.adUnits.find(IOL.adv.headerBidding.replaceAdunitByCode,{code:ads.divId,newcode:ads.divIdSwap.divId});IOL.adv.tools.logger(id+" :: override "+ads.divId+" with "+ads.divIdSwap.divId+", minW: "+ads.divIdSwap.minW+" and maxW:"+ads.divIdSwap.maxW+", page width: "+width,classFunc);ads.divIdSwap.divIdOri=ads.divId;ads.divId=ads.divIdSwap.divId;ads.divIdSwap.swapped=true;IOL.adv.tools.logger("Try to set display:none for "+ads.divIdSwap.divIdOri,classFunc);if(document.getElementById(ads.divIdSwap.divIdOri)){document.getElementById(ads.divIdSwap.divIdOri).style.display='none';IOL.adv.tools.logger("set display:none for "+ads.divIdSwap.divIdOri,classFunc);}else
IOL.adv.tools.logger(ads.divIdSwap.divIdOri+" does not exist or is not ready yet",classFunc);if(document.getElementById(ads.divId)){document.getElementById(ads.divId).style.display='block';IOL.adv.tools.logger("set display:block for "+ads.divId,classFunc);}else
IOL.adv.tools.logger(ads.divId+" does not exist or is not ready yet",classFunc);}else{IOL.adv.tools.logger(id+" :: swap ads container not required, set display:none on swap container: "+ads.divIdSwap.divId+", minW: "+ads.divIdSwap.minW+" and maxW:"+ads.divIdSwap.maxW+", page width: "+width,classFunc);IOL.adv.tools.logger("Try to set display:none for "+ads.divIdSwap.divId,classFunc);if(document.getElementById(ads.divIdSwap.divId)){document.getElementById(ads.divIdSwap.divId).style.display='none';IOL.adv.tools.logger("set display:none for "+ads.divIdSwap.divId,classFunc);}else
IOL.adv.tools.logger(ads.divIdSwap.divId+" does not exist or is not ready yet",classFunc);ads.divIdSwap.swapped=false;}},validRangeSize:function(width,ad,id){var classFunc=IOL.adv.tools.classname+".validRangeSize";var extraDivIdToHide=false;ad.sizeIsCompliant=false;Object.keys(ad.validRangeSize).forEach(function(vKey){IOL.adv.tools.logger(id+" :: check validRangeSize for "+vKey,classFunc);var v=ad.validRangeSize[vKey];if(v){IOL.adv.tools.logger(id+" :: validRangeSize requested for "+vKey+" minW: "+v.minW+", maxW: "+v.maxW+", extraDivIdToHide: "+v.extraDivIdToHide,classFunc);if(!(width>=v.minW&&width<=v.maxW)){IOL.adv.tools.logger(id+" :: page width "+width+" is not compliant with min: "+v.minW+" and max: "+v.maxW,classFunc);v.isCompliant=false;if(v.extraDivIdToHide)extraDivIdToHide=v.extraDivIdToHide;if(v.fallback)v.fallback();}else{IOL.adv.tools.logger(id+" :: page width "+width+" is compliant with min: "+v.minW+" and max: "+v.maxW,classFunc);v.isCompliant=true;if(v.extraDivIdToHide)extraDivIdToHide=v.extraDivIdToHide;}}ad.sizeIsCompliant=ad.sizeIsCompliant||v.isCompliant;});if(!ad.sizeIsCompliant){IOL.adv.tools.logger(id+" :: page width is not compliant with validRangeSize, destroy ad",classFunc);if(document.getElementById(ad.divId)){document.getElementById(ad.divId).style.display='none';IOL.adv.tools.logger(id+" :: set display:none to "+ad.divId,classFunc);}if(extraDivIdToHide){if(document.getElementById(extraDivIdToHide)){IOL.adv.tools.logger(id+" :: set display:none to extraDivIdToHide:"+extraDivIdToHide,classFunc);document.getElementById(extraDivIdToHide).style.display='none';}else{IOL.adv.tools.logger(id+" :: extraDivIdToHide:"+extraDivIdToHide+" does not exist",classFunc);}}if(IOL.adv.settings.prebidjs)if(IOL.adv.settings.prebidjs.adUnits)IOL.adv.settings.prebidjs.adUnits=IOL.adv.settings.prebidjs.adUnits.filter(IOL.adv.headerBidding.rmAdunitByCode,{code:ad.divId});IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id].mediaType="disabledFromRangeSize";}else{IOL.adv.tools.logger(id+" :: page width is compliant with validRangeSize",classFunc);}},mEnable:function(key){var m=false;var force=((IOL.adv.tools.getParameterByName(key)=='on')?true:false);if(IOL.adv.settings.modules)m=(IOL.adv.settings.modules[key])?IOL.adv.settings.modules[key]:false;var t=typeof m;if(t=='object'){IOL.adv.settings.modules[key].enable=IOL.adv.settings.modules[key].enable||force;if(IOL.adv.settings.modules[key].enable)if(typeof IOL.adv.settings.modules[key].f=='function')return IOL.adv.settings.modules[key].f();return IOL.adv.settings.modules[key].enable;}if(t=='boolean')return m||force;},asHandler:function(mode){var classFunc=IOL.adv.classname+".asHandler";try{IOL.adv.tools.logger("Start function, mode: "+mode,classFunc);if(IOL.adv.settings.dmp){if(IOL.adv.settings.dmp["1plusx"]){if(IOL.adv.settings.dmp["1plusx"].tagger.enable&&mode=='tagger'){IOL.adv.tools.logger("start 1plusx tagger...",classFunc);(function(o,n,e,p,l,u,s){o[l]=o[l]||function(){(o[l].q=o[l].q||[]).push(arguments);};u=n.createElement(e);u.async=1;u.src=p;s=n.getElementsByTagName(e)[0];s.parentNode.insertBefore(u,s);}(window,document,"script",IOL.adv.settings.dmp["1plusx"].tagger.url,"ope"));if(window.ope){window.ope("italiaonline","init","tcf2");if(IOL.adv.profile.up.value.ppid)window.ope("italiaonline","send","1stparty-data",{ppid:IOL.adv.profile.up.value.ppid.iol});directoryData={};if(IOL.adv.pubAdsCfg.customCriteria.seat_categoria)directoryData.categoria=IOL.adv.pubAdsCfg.customCriteria.seat_categoria;if(IOL.adv.pubAdsCfg.customCriteria.seat_keyword)directoryData.keyword=IOL.adv.pubAdsCfg.customCriteria.seat_keyword;if(IOL.adv.pubAdsCfg.customCriteria.seat_settore)directoryData.settore=IOL.adv.pubAdsCfg.customCriteria.seat_settore;if(IOL.adv.pubAdsCfg.customCriteria.seat_geo1)directoryData.geo1=IOL.adv.pubAdsCfg.customCriteria.seat_geo1;if(IOL.adv.pubAdsCfg.customCriteria.seat_geo2)directoryData.geo2=IOL.adv.pubAdsCfg.customCriteria.seat_geo2;if(IOL.adv.pubAdsCfg.customCriteria.seat_geo3)directoryData.geo3=IOL.adv.pubAdsCfg.customCriteria.seat_geo3;if(Object.keys(directoryData).length>0)window.ope("italiaonline","send","directory-data",directoryData);}}if(IOL.adv.settings.dmp["1plusx"].api.enable&&mode=='api'){IOL.adv.tools.logger("start 1plusx api...",classFunc);IOL.adv.tools.remoteCall(IOL.adv.settings.dmp["1plusx"].api.url+'?url='+encodeURIComponent(IOL.adv.url)+'&gdpr_applies=0',"GET",true,function(r){IOL.adv.tools.logger("1plusx api loaded",classFunc);if(r){r=JSON.parse(r);IOL.adv.tools.logger("User Profile 1plusx: "+JSON.stringify(r),classFunc);if(r.s)IOL.adv.profile.as.value.s=r.s;if(r.t)IOL.adv.profile.as.value.t=r.t;IOL.adv.profile.as.comingFrom="api";if(IOL.adv.settings.dmp["1plusx"].api.callback){IOL.adv.tools.logger("run callback: "+IOL.adv.settings.dmp["1plusx"].api.callback,classFunc);IOL.adv.settings.dmp["1plusx"].api.callback(IOL.adv.profile.as.value.s);}}else
IOL.adv.tools.logger("1plusx api empty",classFunc);},2000);}}}IOL.adv.tools.logger("end function",classFunc);}catch(e){}},setAdunitPathByBidderCode:function(ad,bidder){var classFunc=IOL.adv.tools.classname+".setAdunitPathByBidderCode";var adUnit=false;IOL.adv.tools.logger("Start setAdunitPathByBidderCode on "+ad.divId+" for bidder: "+bidder,classFunc);if(IOL.adv.settings.prebidjs){var adUnit=IOL.adv.settings.prebidjs.adUnits.filter(IOL.adv.headerBidding.getAdunitByCode,{code:ad.divId});if(adUnit.length>0){adUnit.find(IOL.adv.headerBidding.setAdunitPathByBidderCode,{'bidder':bidder,'adUnitPath':ad.adUnitPath});IOL.adv.tools.logger("adUnit value after setAdunitPathByBidderCode : "+JSON.stringify(adUnit),classFunc);}else
IOL.adv.tools.logger("No setAdunitPathByBidderCode is required for "+ad.divId,classFunc);}else
IOL.adv.tools.logger("No setAdunitPathByBidderCode is required for "+ad.divId,classFunc);return;},displayAds:function(p){var classFunc=IOL.adv.tools.classname+".displayAds";IOL.adv.complete=true;IOL.adv.tools.logger("start function",classFunc);if(IOL.adv.pubAdsCfg.deferredDisplay){IOL.adv.tools.logger("deferredDisplay is enable, nothing to do",classFunc);IOL.adv.tools.logger("IAM complete",classFunc);return;}var slotContainer=(typeof p!=='undefined')?((typeof p.slotContainer!=='undefined')?p.slotContainer:false):false;var slotId=(typeof p!=='undefined')?((typeof p.slotId!=='undefined')?p.slotId:false):false;var mode=(typeof p!=='undefined')?((typeof p.mode!=='undefined')?p.mode:"standard"):"standard";var changeCorrelator=(typeof p!=='undefined')?((typeof p.changeCorrelator!=='undefined')?p.changeCorrelator:true):true;IOL.adv.tools.logger("display engine:"+JSON.stringify(IOL.adv.displayEngine)+", slotContainer:"+JSON.stringify(slotContainer)+", mode:"+mode+", changeCorrelator:"+changeCorrelator,classFunc);IOL.adv.tools.trkPerf("iamRenderingStart",Math.floor(performance.now()));var slots=[];if(slotId)slots.push(IOL.adv.manager.slotsContainer[slotId]);else
if(slotContainer)p.slotContainer.forEach(function(id){slots.push(id);});else
Object.keys(IOL.adv.manager.slotsContainer).forEach(function(id){slots.push(IOL.adv.manager.slotsContainer[id]);});if(IOL.adv.displayEngine.prebid){IOL.adv.tools.logger("display prebid",classFunc);slots=Object.keys(slots).map(function(ad){return slots[ad].getSlotElementId();});var winners=pbjs.getHighestCpmBids();if(winners.length===0){IOL.adv.tools.logger("displayFallback: no bid yet, start waiting for bids",classFunc);var iteration=0;var maxIteration=40;var handle=setInterval(function(){if(pbjs.getHighestCpmBids().length>0||iteration==maxIteration){IOL.adv.tools.logger("displayFallback with bids length: "+pbjs.getHighestCpmBids().length+", iteration: "+iteration,classFunc);IOL.adv.tools.displayPrebid(slots)
clearInterval(handle);}iteration++;},50);}else{IOL.adv.tools.displayPrebid(slots)}}if(IOL.adv.displayEngine.gpt){IOL.adv.tools.logger("display gpt",classFunc);if(IOL.adv.profile.enable){var ppidIol=IOL.adv.getProfile("ppid.iol");if(ppidIol){googletag.pubads().setPublisherProvidedId(ppidIol);IOL.adv.tools.logger("setPublisherProvidedId: "+ppidIol,classFunc);}}googletag.pubads().setPrivacySettings({nonPersonalizedAds:!IOL.adv.profile.enable,childDirectedTreatment:IOL.adv.profile.up.value.isMinor});IOL.adv.tools.logger("Run setCustomCriteria",classFunc);IOL.adv.manager.setCustomCriteria();slots.forEach(function(slot,index,arr){if(IOL.adv.tools.displayPrebidOnDemand(slot.getSlotElementId()))arr.splice(index,1);});googletag.pubads().refresh(slots,{changeCorrelator:changeCorrelator});try{if(typeof IamCallbackDfpCall==="function"){IOL.adv.tools.logger("Hook IamCallbackDfpCall",classFunc);IamCallbackDfpCall();}}catch(e){}}IOL.adv.tools.logger("IAM complete",classFunc);IOL.adv.tools.logger("end function",classFunc);},displayPrebid:function(slots){var classFunc=IOL.adv.tools.classname+".displayPrebid";slots.forEach(function(slot){IOL.adv.tools.logger("start for "+slot,classFunc);var bid=pbjs.getHighestCpmBids(slot)[0];if(!!bid){IOL.adv.tools.trkPerf("iamRenderingEnd",Math.floor(performance.now()),true);IOL.adv.tools.track({e:"time.rendering",key:"time.rendering.prebid."+((IOL.adv.headerBidding.prebidjs.bids)?"bids":"nobids"),t:Math.floor(performance.now()),lv:"info"});if(bid.mediaType==="video"){pbjs.adUnits.forEach(function(data){if(data.code===bid.adUnitCode&&data.mediaTypes.video.hasOwnProperty('context'))if(data.mediaTypes.video.context=='outstream'){IOL.adv.tools.logger("Rendering divid: "+bid.adUnitCode+", bid.adId: "+bid.adId+", bid.mediaType "+bid.mediaType+", bid.adUnitCode "+bid.adUnitCode+" from: "+bid.bidder,classFunc);pbjs.renderAd(document,bid.adId);}});}else
if(bid.mediaType==="banner"){IOL.adv.tools.logger("slot: "+slot+", divid: "+bid.adUnitCode,classFunc);try{var id_ifrm='pbjs_'+bid.adUnitCode;var d=document.getElementById(bid.adUnitCode);d.replaceChildren();var ifr=document.createElement('iframe');ifr.setAttribute('id',id_ifrm);ifr.setAttribute('scrolling','no');ifr.setAttribute('style','border: 0px;');ifr.setAttribute('marginWidth','0');ifr.setAttribute('marginheigth','0');ifr.setAttribute('width','0');ifr.setAttribute('height','0');d.appendChild(ifr);if(document.getElementById(bid.adUnitCode).style.display=="none")document.getElementById(bid.adUnitCode).style.display="block";if(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[slot].forceSafeFrame){IOL.adv.tools.logger("Rendering - in safeFrame - adId: "+bid.adId+", adUnitCode: "+bid.adUnitCode+", bidder: "+bid.bidder,classFunc);ifr.setAttribute('src','https://i3.plug.it/banners/directrender/prebid.html?o='+IOL.adv.origin+"&adID="+bid.adId);}else{IOL.adv.tools.logger("Rendering adId: "+bid.adId+", adUnitCode: "+bid.adUnitCode+", bidder: "+bid.bidder,classFunc);var docIfr=document.getElementById(id_ifrm).contentWindow.document;pbjs.renderAd(docIfr,bid.adId);docIfr.body.style.marginTop="0px";docIfr.body.style.marginBottom="0px";}var event=new CustomEvent("pbjsRenderEnded",{detail:{adUnitCode:slot,mediaType:bid.mediaType,height:bid.height,width:bid.width}});document.dispatchEvent(event);}catch(e){}}IOL.adv.tools.logger("displayAds "+JSON.stringify(pbjs.getAllWinningBids()),classFunc);}else{IOL.adv.tools.logger("no bid for: "+slot,classFunc);var ad=IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[((IOL.adv.manager.divIdAdsIdMap[slot])?IOL.adv.manager.divIdAdsIdMap[slot]:slot)];if(ad){if(ad.mgid){IOL.adv.tools.logger(ad.divId+": mgid found",classFunc);IOL.adv.tools.displayMgid(ad,"asPrebidFallback",function(){return ad.mgid.mode=="asPrebidFallback"},false,classFunc);}}else
IOL.adv.tools.logger("ad not found for: "+slot,classFunc);var event=new CustomEvent("pbjsNoBid",{detail:{adUnitCode:slot,mediaType:false,height:false,width:false}});document.dispatchEvent(event);}});},displayPrebidOnDemand:function(slotId,mode){var classFunc=IOL.adv.tools.classname+".displayPrebidOnDemand";try{var condition=false;var mode=(mode)?mode:"directRendering";var ad=IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[((IOL.adv.manager.divIdAdsIdMap[slotId])?IOL.adv.manager.divIdAdsIdMap[slotId]:slotId)];if(!ad||!IOL.adv.headerBidding.prebidjs.enable){IOL.adv.tools.logger(slotId+" : condition for "+mode+": "+condition,classFunc);return false;}if(!ad.hasOwnProperty("prebidOnDemand")||!ad.prebidOnDemand.hasOwnProperty(mode)){IOL.adv.tools.logger(slotId+" : condition for "+mode+": "+condition,classFunc);return false;}var cpmThreshold=(ad.prebidOnDemand[mode].hasOwnProperty("cpm"))?ad.prebidOnDemand[mode].cpm:(mode==="directRendering")?1.88:0;if(pbjs.getHighestCpmBids(ad.divId)[0]){var cpmBid=pbjs.getHighestCpmBids(ad.divId)[0].cpm;condition=(cpmBid>=cpmThreshold)?true:condition}IOL.adv.tools.logger(slotId+" : condition for "+mode+": "+condition+", cpm: "+cpmBid+", threshold: "+cpmThreshold,classFunc);if(condition){IOL.adv.tools.logger(slotId+" : call displayPrebid for "+mode+", cpmBid: "+cpmBid,classFunc);IOL.adv.tools.displayPrebid([((IOL.adv.manager.divIdAdsIdMap[slotId])?IOL.adv.manager.divIdAdsIdMap[slotId]:slotId)]);ad.prebidOnDemand[mode]["called"]=true;ad.prebidOnDemand[mode].cpmBid=cpmBid;}return condition;}catch(e){IOL.adv.tools.logger(slotId+" mode: "+mode,classFunc,'error');return false;}},displayMgid:function(ad,mode,condition,callback,initiator){var classFunc=IOL.adv.tools.classname+".displayMgid,"+initiator;if(!condition()){IOL.adv.tools.logger(ad.divId+" : mode "+mode+", mgid is not compliant with this mode, ads config: "+JSON.stringify(ad.mgid),classFunc);return;}if((ad.mgid.script&&ad.mgid.divId)||(ad.mgid.iframeSrc&&ad.mgid.width&&ad.mgid.height)){var d=document.getElementById(ad.divId);if(d){IOL.adv.tools.logger(ad.divId+" : mode "+mode+", mgid is compliant with this mode, ads config: "+JSON.stringify(ad.mgid),classFunc);if(callback)callback();d.replaceChildren();if(ad.mgid.iframeSrc&&ad.mgid.width&&ad.mgid.height){var ifr=document.createElement('iframe');ifr.setAttribute('src',ad.mgid.iframeSrc);ifr.setAttribute('width',ad.mgid.width);ifr.setAttribute('height',ad.mgid.height);ifr.setAttribute('scrolling','no');ifr.setAttribute('style','border: 0px;');ifr.setAttribute('marginWidth','0');ifr.setAttribute('marginheigth','0');d.appendChild(ifr);d.display='block';}if(ad.mgid.divId&&ad.mgid.script){d=document.createElement('div');d.id=ad.mgid.divId;var js=document.createElement("script");js.type="text/javascript";js.src=ad.mgid.script;d.appendChild(js);var target=(ad.mgid.onDivId)?ad.mgid.onDivId:ad.divId;if(document.getElementById(target))document.getElementById(target).appendChild(d);}ad.onRenderEnded.push({forceOnSlotRenderEnded:true,allowedSizes:['empty'],callback:function(a){document.getElementById(ad.divId).style.display='block'}});if(typeof ad.mgid.onRenderEnded==='function'){IOL.adv.tools.logger("run onRenderEnded for mgid on: "+ad.divId,classFunc);ad.mgid.onRenderEnded();}IOL.adv.complete=true;IOL.adv.displayEngine.mgid=true;IOL.adv.tools.track({e:"time.rendering",key:"time.rendering.mgid."+((IOL.adv.headerBidding.prebidjs.bids)?"bids":"nobids"),t:Math.floor(performance.now()),lv:"info"});}else
IOL.adv.tools.logger(ad.divId+" not found in page",classFunc);}else
IOL.adv.tools.logger("one or more attributes are not defined"+ad.divId,classFunc);},displayKetai:function(ad,mode,condition,callback,initiator){var classFunc=IOL.adv.tools.classname+".displayKetai,"+initiator;if(!condition()){IOL.adv.tools.logger(ad.divId+" : mode "+mode+", ketai is not compliant with this mode, ads config: "+JSON.stringify(ad.mgid),classFunc);return;}if(ad.ketai){var d=document.getElementById(ad.divId);if(d){IOL.adv.tools.logger(ad.divId+" : mode "+mode+", ketai is compliant with this mode, ads config: "+JSON.stringify(ad.ketai),classFunc);if(callback)callback();d.replaceChildren();if(ad.ketai.html&&ad.ketai.script){IOL.adv.tools.logger(ad.divId+" : inject ketai html",classFunc);d.innerHTML=ad.ketai.html;var s=document.createElement('script');s.innerHTML=ad.ketai.script;d.appendChild(s);}ad.onRenderEnded.push({forceOnSlotRenderEnded:true,allowedSizes:['empty'],callback:function(a){document.getElementById(ad.divId).style.display='block'}});if(typeof ad.ketai.onRenderEnded==='function'){IOL.adv.tools.logger("run onRenderEnded for ketai on: "+ad.divId,classFunc);ad.ketai.onRenderEnded();}IOL.adv.complete=true;IOL.adv.displayEngine.ketai=true;IOL.adv.tools.track({e:"time.rendering",key:"time.rendering.ketai."+((IOL.adv.headerBidding.prebidjs.bids)?"bids":"nobids"),t:Math.floor(performance.now()),lv:"info"});}else
IOL.adv.tools.logger(ad.divId+" not found in page",classFunc);}else
IOL.adv.tools.logger("one or more attributes are not defined"+ad.divId,classFunc);},remoteCall:function(url,data,withCredentials,fn,timeout){var classFunc=IOL.adv.tools.classname+".remoteCall";var timeout=(timeout)?timeout:20000;var method=(data=="GET")?"GET":"POST";var data=(method=="GET")?"":data;IOL.adv.tools.logger("remoteCall url:"+url+", method: "+method,classFunc);try{var x=new XMLHttpRequest();if(fn){x.onreadystatechange=function(){if(x.readyState===XMLHttpRequest.DONE&&x.status===200){fn(x.responseText);}};}var useSSL='https:'==document.location.protocol;url=((useSSL||IOL.adv.pubAdsCfg.forceHttps)?'https:':'http:')+url;x.open(method,url,true);x.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8");if(method=="GET")x.setRequestHeader("Referrer-Policy","no-referrer-when-downgrade");x.datatype="json";if(withCredentials)x.withCredentials=withCredentials;x.onprogress=function(){};x.timeout=timeout;x.send(data);}catch(e){IOL.adv.tools.logger("err remoteCall e: "+e.message,classFunc);}},getDomain:function(s){var d=s.split('.');if(d.length>2)d.shift();return'.'+d.join('.');},getParameterByName:function(name){var res=new RegExp('[\?&]'+name.replace(/\[/g,'\\\[').replace(/\]/g,'\\\]')+'(?:=([^&#]*))?(?:[&#]|$)').exec(window.location.search);return res?(res[1]?decodeURIComponent(res[1].replace(/\+/g,' ')):''):null;},extend:function(obj,src){for(var key in src){if(src.hasOwnProperty(key))obj[key]=src[key];}return obj;},digPadding:function(number,digits){return Array(Math.max(digits-String(number).length+1,0)).join(0)+number;},objAssigner:function(a,b){Object.keys(b).forEach(function(key){a[key]=b[key];});},getMetaTag:function(n,s){var v=[];try{var m=document.getElementsByTagName('meta')[n];if(m!=undefined){m=m.getAttribute("content");if(m!=undefined){if(s){m=m.split(s).filter(function(e){if(e)return true;});for(var i=0;i<m.length;i++){var val=m[i].replace(/\s/g,'')
if(val!='')v[i]=m[i].trim();}}else
v=m;}}}catch(e){}finally{return((v!=undefined)?v:false);}},getReferrerLabel:function(r,d){var classFunc=IOL.adv.tools.classname+".getReferrerLabel";var v=d;var map={'site':['.*'+IOL.adv.domain.replace(/\./g,'\\.')+'$'],'search':[/arianna\.libero\.it$/,/ricerca.*\.virgilio\.it$/,/.*\.google\.[a-z]{2,3}$/,/.*\.bing\.com$/,/.*\.ask\.[a-z]{2,3}$/,/.*\.hotbot\.[a-z]{2,3}$/,/.*\.dogpile\.[a-z]{2,3}$/,/.*\.lycos\.[a-z]{2,3}$/,/.*\.yandex\.[a-z]{2,3}$/,/.*\.exalead\.[a-z]{2,3}$/,/.*\.gigablast\.[a-z]{2,3}$/,/.*\.yahoo\.[a-z]{2,3}$/,/.*\.sogou\.[a-z]{2,3}$/,/.*\.search\.[a-z]{2,3}$/,/.*\.duckduckgo\.[a-z]{2,3}$/,/.*\.istella\.[a-z]{2,3}$/,/.*\.qwant\.[a-z]{2,3}$/,/.*\.searx\.[a-z]{2,3}$/,/.*\.qwant\.[a-z]{2,3}$/],'linked':[/.*\.italiaonline\.it$/,/.*\.virgilio\.it$/,/.*\.libero\.it$/,/.*\.buonissimo\.it$/,/.*\.dilei\.it$/,/.*\.quifinanza\.it$/,/.*\.siviaggia\.it$/,/.*\.supereva\.it$/,/.*\.myblog\.it$/,/.*\.xoom\.it$/,/.*\.initalia\.it$/,/.*\.paginebianche\.it$/,/.*\.paginegialle\.it$/,/.*\.tuttocitta\.it$/,/.*\.seat\.it$/]};IOL.adv.tools.logger("page domain: "+IOL.adv.domain+", referrer: "+r,classFunc);try{var refDomain=(new URL(r)).hostname.toLowerCase();refDomain=((!refDomain.startsWith('.'))?'.'+refDomain:refDomain);IOL.adv.tools.logger("Referrer domain: "+refDomain,classFunc);Object.keys(map).forEach(function(k){for(var i=0;i<map[k].length&&v==d;i++){IOL.adv.tools.logger("Apply regEx: "+map[k][i]+" on domain: "+refDomain+" for case: "+k,classFunc);if(refDomain.match(map[k][i])){v=k;IOL.adv.tools.logger("Match found, assign label: "+v,classFunc);}}});}catch(e){IOL.adv.tools.logger("Referrer url is empty, return the default value: "+v,classFunc);}finally{return v;}},find:function(needle,haystack){var classFunc=IOL.adv.tools.classname+".setOptionalCustomParams";var found='';IOL.adv.tools.logger("needle:"+needle+" haystack:"+JSON.stringify(haystack),classFunc);if(needle&&haystack){IOL.adv.tools.logger("try to find needle in haystack",classFunc);found=((haystack[needle])?haystack[needle]:'');}IOL.adv.tools.logger("found: "+found,classFunc);return found;},filterArrayInArray:function(v){var classFunc=IOL.adv.tools.classname+".filterArrayInArray";var ret=true;this.list.forEach(function(prop){IOL.adv.tools.logger("prop:"+prop+" typeof v:"+typeof v+" value: "+v,classFunc);if(typeof v==="object"){if(v.join('x')==prop.join('x')){IOL.adv.tools.logger("Bad size found",classFunc);ret=false;}}else{IOL.adv.tools.logger("Bad size found or not managed",classFunc);ret=false;}});return ret;},randomId:function(){var f=function(){return(((1+Math.random())*0x10000)|0).toString(16).substring(1);};return(f()+f()+f()+f()+f()+f()+f()+f());},randomInt:function(min,max){min=Math.ceil(min);max=Math.floor(max);return Math.floor(Math.random()*(max-min+1)+min);},inject:function(l){var classFunc=IOL.adv.tools.classname+".inject";if(l.enable)if(l.condition){IOL.adv.tools.logger("typeof condition: "+typeof l.condition,classFunc);if(typeof l.condition=="string")l.enable=eval(l.condition);if(typeof l.condition=="function")l.enable=l.condition();}IOL.adv.tools.logger((l.enable?"loading":"discard")+" url: "+l.url+", enable: "+l.enable+", mandatory: "+l.mandatory+", condition: "+l.condition,classFunc);if(l.enable&&l.url!==''){if(typeof l.url=='function')l.url=l.url();IOL.adv.tools.timer(classFunc,l.url,"start");IOL.adv.tools.loadJs(l.url,function(){l.live=true;l.status='error';l.duration=IOL.adv.tools.timer(classFunc,l.url,"partial");IOL.adv.debug.tracking.adblock=true;IOL.adv.tools.trkPerf("iamAdblock",Math.floor(performance.now()));IOL.adv.tools.track({e:"error.adblock",t:Math.floor(performance.now()),lv:"error"});if(l.onError)l.onError();},function(){l.live=true;l.status="loaded";l.duration=IOL.adv.tools.timer(classFunc,l.url,"partial");IOL.adv.tools.logger("Time elapsed for loading "+l.url+" is "+l.duration,classFunc);if(l.onLoad)l.onLoad();},(l.id)?l.id:false);}},cmpHandler:function(initiator,callback,fallback,timer,wait){var classFunc=IOL.adv.tools.classname+".cmpHandler,"+initiator;var timer=timer?timer:false;var wait=wait?wait:true;if(IOL.adv.gdpr.tcfv20.enable)IOL.adv.gdpr.enable=true;if(IOL.adv.gdpr.enable||(IOL.adv.settings.hasOwnProperty("tcfv20")&&IOL.adv.settings.tcfv20.pipeline.method=='demand')){IOL.adv.tools.logger("cmp is ready or pipeline method is on demand, run callback function",classFunc);callback();return;}if(wait){IOL.adv.tools.logger("cmp is not ready yet, try with setInterval",classFunc);var iteration=0;timer=setInterval(function(){IOL.adv.gdpr.enable=((typeof __tcfapi==='function')?true:false);if(IOL.adv.gdpr.enable){clearInterval(timer);IOL.adv.tools.logger("cmp is ready",classFunc);callback();}else{if(iteration>IOL.adv.gdpr.maxIteration){IOL.adv.gdpr.timedOut=true;clearInterval(timer);IOL.adv.tools.logger("cmp is not ready, run fallback or callback function",classFunc);if(fallback)fallback();else
callback();}else{iteration++;IOL.adv.tools.logger("cmp is not ready yet, please wait...",classFunc);}}},IOL.adv.gdpr.interval);}else{callback();}},getConsent:function(purpose,vendor){var classFunc=IOL.adv.tools.classname+".getConsent";var args={purpose:(purpose)?Array.isArray(purpose)?purpose:Array(purpose):[],vendor:(vendor)?Array.isArray(vendor)?vendor:Array(vendor):[]};var consent=true;if(!IOL.adv.gdpr.enable)consent=false;if(!IOL.adv.gdpr.tcfv20.tcData)consent=false;for(var type in args){for(var i=0;i<args[type].length;i++){if(IOL.adv.gdpr.tcfv20.tcData.hasOwnProperty(type)&&IOL.adv.gdpr.tcfv20.tcData[type].hasOwnProperty("consents")){var element=args[type][i];if(!IOL.adv.gdpr.tcfv20.tcData[type].consents[element]){consent=false;break;}}else{consent=false;break;}}}IOL.adv.tools.logger("Consent for: "+JSON.stringify(args)+" is "+consent,classFunc);return consent;},track:function(msg){var classFunc=IOL.adv.tools.classname+".track";try{IOL.adv.tools.logger("track event: "+JSON.stringify(msg),classFunc);if(!IOL.adv.debug.tracking.enable||IOL.adv.debug.tracking.evnt[msg.e]){IOL.adv.tools.logger("Track elk disable or already done for "+msg.e,classFunc);return;}var fn=[];fn.push((IOL.adv.gdpr.enable)?"gdprOn":(IOL.adv.gdpr.timedOut)?"gdprFail":"gdprOff");fn.push((IOL.adv.gdpr.consentGoogle)?"consentOn":"consentOff");fn.push((IOL.adv.debug.tracking.adblock)?"adBlockOn":"adBlockOff");fn.push((IOL.adv.profile.up.value.up)?"upOn":"upOff");fn.push((IOL.adv.headerBidding.enable)?"hbOn":"hbOff");fn.push((IOL.adv.complete||msg.e.startsWith("time.rendering"))?"complete":"uncomplete");var div=(msg.div)?msg.div:"";var v=IOL.adv.version+"::"+fn.join(".")+"::"+IOL.adv.settings.ns+"::"+IOL.adv.pubAdsCfg.slot+"::"+div+"::"+((msg.key)?msg.key:msg.e)+"::"+msg.t;IOL.adv.debug.tracking.evnt[msg.e]={v:v,lv:msg.lv};IOL.adv.tools.logger("dump for tracking event: "+msg.e+", lv:"+IOL.adv.debug.tracking.evnt[msg.e].lv+", v:"+IOL.adv.debug.tracking.evnt[msg.e].v,classFunc,msg.lv);IOL.adv.tools.remoteCall(IOL.adv.server+IOL.adv.debug.tracking.handler,"rf="+IOL.adv.url+"&d="+IOL.adv.domain+"&lv="+IOL.adv.debug.tracking.evnt[msg.e].lv+"&msg="+IOL.adv.debug.tracking.evnt[msg.e].v);}catch(err){IOL.adv.tools.logger("track exception: "+err,classFunc,'error');}},trkPerf:function(evnt,time,attr){var classFunc=IOL.adv.tools.classname+".trkPerf";try{if(!IOL.adv.tools.mEnable("trkPerf")||IOL.adv.debug.tracking.time[evnt]){IOL.adv.tools.logger("Track druid disable or already done for "+evnt,classFunc);return;}IOL.adv.debug.tracking.time[evnt]=time;var t,w,d;try{t=Date.now();}catch(er){t=0;}try{w=screen.width;}catch(er){w=0;}try{d=window.location.hostname;}catch(e){d='error';}var attributes=[];if(typeof attr==="boolean"){if(attr){attributes.push((IOL.adv.gdpr.consentGoogle)?'consentGoogleTrue':'consentGoogleFalse');attributes.push((IOL.adv.gdpr.enable)?'gdprEnable':'gdprDisable');attributes.push((IOL.adv.displayEngine.gpt)?'displayGpt':'displayFallback');attributes.push((IOL.adv.debug.tracking.adblock)?'adblockTrue':'adblockFalse');attributes.push((IOL.adv.headerBidding.prebidjs.enable)?'hbTrue':'hbFalse');attributes.push((IOL.adv.headerBidding.prebidjs.bids)?'bids':'nobids');attributes.push((IOL.adv.profile.up.value.up)?'ssoTrue':'ssoFalse');}}if(typeof attr==="object")if(Array.isArray(attr))attributes=attr;var url="https://evnt.iol.it/v2?&pgnf="+d+",all,,,,0,"+w+",0,,b,0,"+'iam'+IOL.adv.version+";"+IOL.adv.settings.ns+((attributes.length>0)?(";"+attributes.join(";")+((attributes.length>1)?";"+attributes.join("_"):'')):'')+","+evnt+","+time+"&nc="+t;var i=new Image();i.src=url;IOL.adv.tools.logger("track: "+evnt+", url: "+url,classFunc);}catch(err){IOL.adv.tools.logger("track exception: "+err,classFunc,'error');}},trkIdentity:function(e){var classFunc=IOL.adv.tools.classname+".trkIdentity";try{var d,t;d=window.location.hostname;t=Date.now();var url="https://evnt.iol.it/v3?&pgnf="+d+","+e.partner+","+e.ppid+",,identity_id,,0,,,0,,,0,,,0,0,0&nc="+t;var i=new Image();i.src=url;IOL.adv.tools.logger("track: "+e.partner,classFunc);}catch(err){IOL.adv.tools.logger("track exception: "+err,classFunc,'error');}},trkVideo:function(e){var classFunc=IOL.adv.tools.classname+".trkVideo";try{if(!IOL.adv.tools.mEnable("trkVideo")){IOL.adv.tools.logger("Track druid disable or already done for "+e.evnt,classFunc);return;}var d,t;d=window.location.hostname;t=Date.now();var attrs=["rel_"+e.reload,"req_"+e.count,"rel_"+e.reload+"_req_"+e.count].join(";")
var url="https://evnt.iol.it/v2?&pgnf="+IOL.adv.videoAds.bob.mailVersion+",,"+IOL.adv.videoAds.bob.from+",,,30,640,0,,,0,"+attrs+","+e.evnt+","+e.time+"&nc="+t;var i=new Image();i.src=url;IOL.adv.tools.logger("track: "+e.evnt+", url: "+url,classFunc);}catch(err){IOL.adv.tools.logger("track exception: "+err,classFunc,'error');}},delElementById:function(e){var classFunc=IOL.adv.tools.classname+".delElementById";var ids=Array.isArray(e)?e:Array(e);try{ids.forEach(function(id){var d=document.getElementById(id);if(d!==null){IOL.adv.tools.logger(id+" found, run d.parentNode.removeChild()",classFunc);d.parentNode.removeChild(d);}else
IOL.adv.tools.logger(id+" not found",classFunc);});}catch(e){IOL.adv.tools.logger("del id exception: "+e,classFunc,'error');}},debugInit:function(){var classFunc=IOL.adv.tools.classname+".debugInit";IOL.adv.debug.log.enable=(IOL.adv.cookie.get('iamdbg',true)?true:false);if(IOL.adv.tools.getParameterByName("iam_console")){try{var console=JSON.parse(IOL.adv.tools.getParameterByName("iam_console"));IOL.adv.tools.objAssigner(IOL.adv.pubAdsCfg,console);IOL.adv.debug.log.enable=((IOL.adv.pubAdsCfg.log)?IOL.adv.pubAdsCfg.log:IOL.adv.debug.log.enable);IOL.adv.debug.console.enable=((IOL.adv.pubAdsCfg.console)?IOL.adv.pubAdsCfg.console:IOL.adv.debug.console.enable);IOL.adv.debug.tracking.enable=((IOL.adv.pubAdsCfg.tracking)?IOL.adv.pubAdsCfg.tracking:IOL.adv.debug.tracking.enable);}catch(e){IOL.adv.tools.logger("Error parsing debug parameter, please use the following specs: {\"log\":true,\"console\":true,\"lazy\":true,\"prebid\":false}",classFunc,'error');}}if(IOL.adv.debug.log.enable)IOL.adv.debug.log.id=IOL.adv.tools.randomId();IOL.adv.debug.tracking.percentCustomerBase=((IOL.adv.settings.percentCustomerBase)?IOL.adv.settings.percentCustomerBase:IOL.adv.debug.tracking.percentCustomerBase);IOL.adv.debug.tracking.randomInt=IOL.adv.tools.randomInt(1,100);if(IOL.adv.debug.tracking.randomInt<=IOL.adv.debug.tracking.percentCustomerBase||IOL.adv.debug.tracking.enable)IOL.adv.debug.tracking.enable=true&&(typeof window.performance!=='undefined'&&typeof window.performance.now!=='undefined');IOL.adv.tools.logger("log enable: "+IOL.adv.debug.log.enable+", track enable: "+IOL.adv.debug.tracking.enable,classFunc);},reloadPageInDebugMode:function(){var _url=location.href;_url=(_url.indexOf('?')!==-1)?_url+'&iam_console={"log":true}':_url+'?iam_console={"log":true}';window.location.href=_url;},reloadPageWithConsole:function(){var _url=location.href;_url=(_url.indexOf('?')!==-1)?_url+'&iam_console={"console":true}':_url+'?iam_console={"console":true}';window.location.href=_url;},onRenderEnded:function(ad,e){var classFunc=IOL.adv.tools.classname+".onRenderEnded";document.addEventListener('pbjsRenderEnded',function(item){var attr=IOL.adv.tools.getSlotAttribute(ad,item)
if(attr){ad.onRenderEnded.slotAttribute=(attr)?attr:ad.onRenderEnded.slotAttribute;IOL.adv.tools.startEvent(ad,e,ad.onRenderEnded.slotAttribute);}});googletag.pubads().addEventListener('slotRenderEnded',function(item){if(item.slot.getSlotElementId()===ad.divId&&!ad.onRenderEnded.slotAttribute){ad.onRenderEnded.slotAttribute=IOL.adv.tools.getSlotAttribute(ad,item);IOL.adv.tools.logger("slotRenderEnded: slotAttribute for "+ad.divId+" attribute: "+JSON.stringify(ad.onRenderEnded.slotAttribute),classFunc);}if(item.slot.getSlotElementId()===ad.divId&&ad.onRenderEnded.slotAttribute&&e.forceOnSlotRenderEnded==true){IOL.adv.tools.logger("slotRenderEnded: slotAttribute is ready, value:"+JSON.stringify(ad.onRenderEnded.slotAttribute)+", run startEvent",classFunc);IOL.adv.tools.startEvent(ad,e,ad.onRenderEnded.slotAttribute);}});googletag.pubads().addEventListener('slotOnload',function(item){if(item.slot.getSlotElementId()===ad.divId){IOL.adv.tools.logger("startEvent from slotOnload: "+ad.divId,classFunc);var iteration=0;var maxIteration=20;if(!ad.onRenderEnded.slotAttribute){var i=setInterval(function(){IOL.adv.tools.logger("slotOnload: slotAttribute for "+ad.divId+" is undefined on iteration: "+iteration,classFunc);if(ad.onRenderEnded.slotAttribute||iteration==maxIteration){if(ad.onRenderEnded.slotAttribute){IOL.adv.tools.logger("slotOnload: slotAttribute is ready on iteration: "+iteration+", value:"+JSON.stringify(ad.onRenderEnded.slotAttribute)+", run startEvent",classFunc);IOL.adv.tools.startEvent(ad,e,ad.onRenderEnded.slotAttribute);}clearInterval(i);}iteration++;},50);}else
IOL.adv.tools.startEvent(ad,e,ad.onRenderEnded.slotAttribute);}});},getSlotAttribute:function(ad,e){var classFunc=IOL.adv.tools.classname+".getSlotAttribute";var displayFallback=(!!e.detail&&e.type==='pbjsRenderEnded')?e.detail:false;var slotId=(displayFallback)?displayFallback.adUnitCode:e.slot.getSlotElementId();var w=(displayFallback)?displayFallback.width:(!e.isEmpty&&e.size)?e.size[0]:false;var h=(displayFallback)?displayFallback.height:(!e.isEmpty&&e.size)?e.size[1]:false;var advertiserId=(displayFallback)?false:(e.hasOwnProperty("advertiserId"))?e.advertiserId:false;var slotAttribute={slotId:slotId,displayFallback:(displayFallback)?true:false,w:w,h:h,advertiserId:(advertiserId)?advertiserId:false};return((slotId===ad.divId)?slotAttribute:false);},startEvent:function(ad,e,slotAttribute){var classFunc=IOL.adv.tools.classname+".startEvent";var b=(typeof e.condition=='function')?e.condition():true;ad.onRenderEnded.runned=(ad.onRenderEnded.hasOwnProperty("runned"))?ad.onRenderEnded.runned+1:1;IOL.adv.tools.logger("condition: "+e.condition+" for "+ad.divId+" is "+b+" runned "+ad.onRenderEnded.runned,classFunc);if(!b){if(ad.onRenderEnded.runned===ad.onRenderEnded.length){delete ad.onRenderEnded.slotAttribute;ad.onRenderEnded.runned=0;}return;}var slotId=slotAttribute.slotId;e.called=false;if(!slotAttribute.displayFallback&&IOL.adv.headerBidding.prebidjs.enable){pbjs.getAllWinningBids().forEach(function(e){if(e.adUnitCode==ad.divId){slotAttribute.w=e.width;slotAttribute.h=e.height;IOL.adv.tools.logger("getAllWinningBids:slotAttribute from getAllWinningBids: "+ad.divId+" attribute: w:"+slotAttribute.w+", h:"+slotAttribute.h,classFunc);}});}if(slotAttribute.w&&slotAttribute.h){var size=slotAttribute.w.toString().concat('x',slotAttribute.h.toString());IOL.adv.tools.logger(slotId+" size:"+size+", allowedSizes:"+e.allowedSizes,classFunc);try{if(e.allowedSizes.includes(size)||e.allowedSizes.includes('*')){IOL.adv.tools.logger("run callback: "+e.callback+" on: "+slotId+", with args: "+JSON.stringify({w:slotAttribute.w,h:slotAttribute.h}),classFunc);if(e.callback){e.callback({ad:ad,w:slotAttribute.w,h:slotAttribute.h,advertiserId:slotAttribute.advertiserId});e.called=true;}else
IOL.adv.tools.logger("callback is not defined",classFunc);}else{IOL.adv.tools.logger("divid "+ad.divId+" sizes not compliant with AllowedSizes",classFunc);}if(ad.onRenderEnded.runned===ad.onRenderEnded.length){delete ad.onRenderEnded.slotAttribute;ad.onRenderEnded.runned=0;}}catch(e){IOL.adv.tools.logger("callback error",classFunc);}}else{if(e.allowedSizes.includes('empty')){if(e.callback){IOL.adv.tools.logger("run callback: "+e.callback+" on: "+slotId+", with size 'empty' on allowedSizes",classFunc);e.callback({ad:ad,w:slotAttribute.w,h:slotAttribute.h,advertiserId:slotAttribute.advertiserId});e.called=true;}else
IOL.adv.tools.logger("callback is not defined",classFunc);}}},syncId:function(update){var classFunc=IOL.adv.tools.classname+".syncId";IOL.adv.tools.logger("Start function",classFunc);if(!IOL.adv.syncId.enable||IOL.adv.profile.up.value.isMinor){IOL.adv.tools.logger("Sync disabled: "+IOL.adv.syncId.enable+", isMinor:"+IOL.adv.profile.up.value.isMinor,classFunc);return;}if(IOL.adv.tools.mEnable("amazonId")&&window.apstag&&IOL.adv.syncId.vendor.amazon.enable){var ppidAmz=IOL.adv.getProfile("ppid.zeo");if(ppidAmz){IOL.adv.headerBidding.apstagInit();var tokenConfig={hashedRecords:[{type:'email',record:ppidAmz}]};if(update){IOL.adv.tools.logger("Sync amazonId update calling apstag.upa with ppid: "+ppidAmz,classFunc);window.apstag.upa(tokenConfig);}else{IOL.adv.tools.logger("Sync amazonId calling apstag.rpa with ppid: "+ppidAmz,classFunc);window.apstag.rpa(tokenConfig);}IOL.adv.tools.trkIdentity({partner:"amazonID",ppid:ppidAmz});}else{IOL.adv.tools.logger("Remove amazonId calling apstag.dpa",classFunc);window.apstag.dpa();}}if(IOL.adv.tools.mEnable("neustarLinkage")&&IOL.adv.syncId.vendor.neustarLinkage.enable){var ppidNL=IOL.adv.getProfile("ppid.zeo");if(ppidNL){IOL.adv.tools.loadJs("//aa.agkn.com/adscores/s.js?sid=9112312688&em="+ppidNL,false,function(){IOL.adv.tools.logger("Sync neustarLinkage with ppid: "+ppidNL,classFunc);IOL.adv.tools.trkIdentity({partner:"neustar",ppid:ppidNL});},false);}}if(IOL.adv.tools.mEnable("neustarPG")&&IOL.adv.syncId.vendor.neustarPG.enable)IOL.adv.tools.loadJs('//pghub.io/js/pandg-sdk.js',false,function(){IOL.adv.tools.logger("Sync NeustarPG",classFunc);var metadata={gdpr:(IOL.adv.gdpr.consentString)?1:0,gdpr_consent:(IOL.adv.gdpr.consentString)?IOL.adv.gdpr.consentString:"",bp_id:"iolitaly",};var config={name:"P&G",pixelUrl:"//pandg.tapad.com/tag"};var tagger=Tapad.init(metadata,config);var data={};tagger.sync(data);});if(IOL.adv.syncId.vendor.groupm.enable){var ppidGm=IOL.adv.getProfile("ppid.gm");if(ppidGm){IOL.adv.tools.logger("Sync refine with ppid: "+ppidGm,classFunc);window._adftrack=Array.isArray(window._adftrack)?window._adftrack:(window._adftrack?[window._adftrack]:[]);window._adftrack.push({pm:1253522,divider:encodeURIComponent('|'),pagename:encodeURIComponent('nc'),order:{sv1:'1',sv2:'0',sv3:'413',sv4:'0',sv5:ppidGm,sv6:'1',sv7:'true',sv8:'2'}});(function(){var s=document.createElement('script');s.type='text/javascript';s.async=true;s.src='https://track.adform.net/serving/scripts/trackpoint/async/';var x=document.getElementsByTagName('script')[0];x.parentNode.insertBefore(s,x);})();IOL.adv.tools.trkIdentity({partner:"refine",ppid:ppidGm});}}if(IOL.adv.tools.mEnable("zeotap")&&IOL.adv.syncId.vendor.zeotap.enable){var ppidZeo=IOL.adv.getProfile("ppid.zeo");IOL.adv.tools.loadJs("//spl.zeotap.com/mapper.js?zdid=1396&idp_partnerid=e2556ea9-3786-4445-a639-eb5d4863e6a2&ctry=ITA&env=mWeb&eventType=pageview&idp=1&partner_dom="+IOL.adv.hostname+"&z_e_sha2_l="+((ppidZeo)?ppidZeo:""),false,function(){if(ppidZeo){IOL.adv.tools.logger("Sync zeotap with ppid: "+((ppidZeo)?ppidZeo:""),classFunc);IOL.adv.tools.trkIdentity({partner:"zeotap",ppid:ppidZeo});}},"zeo_mapping");}if(IOL.adv.tools.mEnable("liveramp")&&IOL.adv.syncId.vendor.liveramp.enable){var ppidLr=IOL.adv.getProfile("ppid.zeo");if(ppidLr&&IOL.adv.settings.modules.liveramp.url){IOL.adv.tools.loadJs(IOL.adv.settings.modules.liveramp.url,false,function(){IOL.adv.tools.logger("Sync liveramp with ppid: "+ppidLr,classFunc);ats.setAdditionalData({'type':'emailHashes','id':[ppidLr]});IOL.adv.tools.trkIdentity({partner:"liveramp",ppid:ppidLr});},false);}}if(IOL.adv.tools.mEnable("rematch")){var ppidRem=IOL.adv.getProfile("ppid.rem");if(typeof ppidRem=='string')if((ppidRem.startsWith("L")||ppidRem.startsWith("V"))&&IOL.adv.settings.modules.rematch.url){var token=IOL.adv.cookie.get("LIB_ADV_UCK");if(token){token=token.split("%7C");if(token.length>=2){ppidRem=token[1]+'_'+ppidRem;IOL.adv.tools.logger("Sync rematch with ppid: "+ppidRem,classFunc);IOL.adv.tools.trkIdentity({partner:"rematch",ppid:ppidRem});var img=new Image();img.src=IOL.adv.settings.modules.rematch.url+ppidRem;}}}}IOL.adv.tools.logger("End function",classFunc);},getBrowser:function(){var classFunc=IOL.adv.settings.classname+".getBrowser";var ua=navigator.userAgent;var b;if(ua.match(/chrome|chromium|crios/i)){b="chrome";}else if(ua.match(/firefox|fxios/i)){b="firefox";}else if(ua.match(/safari/i)){b="safari";}else if(ua.match(/opr\//i)){b="opera";}else if(ua.match(/edg/i)){b="edge";}else{b=false;}IOL.adv.tools.logger("Browser: "+b,classFunc);return b;},eViewTrigger:function(e){var classFunc=IOL.adv.tools.classname+".eViewTrigger";try{if(!e.config.ad)throw"ads not set";if(!IOL.adv.manager.slotsContainer[e.config.ad.id])throw"ads "+e.config.ad.id+" not found";e.config.el=document.getElementById(e.config.ad.divId);if(!e.config.el)throw"ads container not found";var interval=1;var time=0;e.config.percentView=(e.config.percentView)?e.config.percentView:100;e.config.onFocusChange=(e.config.onFocusChange)?e.config.onFocusChange:false;e.config.onFocusChangeBoost=(e.config.onFocusChangeBoost)?e.config.onFocusChangeBoost:0.25;e.config.callback=(e.config.callback)?e.config.callback:function(){IOL.adv.refreshSlot(e.config.ad.id)};e.config.hasFocus=document.hasFocus();var adsH=e.config.h;e.config.adsH=adsH-Math.floor(e.config.percentView/100*adsH);IOL.adv.tools.logger(e.config.ad.id+" :: config: "+JSON.stringify(e.config),classFunc);IOL.adv.manager.slotsContainer[e.config.ad.id].setTargeting("adv_refresh",true);var i=setInterval(function(){var eBox=e.config.el.getBoundingClientRect();var eTopY=eBox.top+e.config.adsH;var eBottomY=eBox.top+(eBox.height-e.config.adsH);var hasFocus=document.hasFocus();var focusChanged=e.config.onFocusChange&&hasFocus&&e.config.hasFocus!==hasFocus;time+=(focusChanged)?Math.floor(e.config.thresholdTime*e.config.onFocusChangeBoost):0;if(hasFocus&&eTopY>=0&&eBottomY>=0&&eBottomY<=Math.min(document.documentElement.clientHeight,window.innerHeight||0))time+=interval;IOL.adv.tools.logger(e.config.ad.id+" :: viewed time: "+time+", hasFocus: "+hasFocus+", focusChanged: "+focusChanged+", eTopY:"+eTopY+", eBottomY:"+eBottomY+", Math.min:"+Math.min(document.documentElement.clientHeight,window.innerHeight||0),classFunc);if(time>=e.config.thresholdTime){IOL.adv.tools.logger(e.config.ad.id+" :: threshold reached",classFunc);clearInterval(i);e.config.callback();}e.config.hasFocus=hasFocus;},interval*1000);}catch(e){IOL.adv.tools.logger("Error: "+e,classFunc,"error");}},setPrebidUrl:function(urlGdprDisable){var classFunc=IOL.adv.settings.classname+".setPrebidUrl";if(!IOL.adv.gdpr.enable&&urlGdprDisable)IOL.adv.settings.library.prebid.url=urlGdprDisable;return true;},parseUp:function(f){var classFunc=IOL.adv.settings.classname+".parseUp";if(!IOL.adv.profile.up.value.up){IOL.adv.tools.logger("up is empty, coming from: "+f,classFunc);return;}IOL.adv.profile.up.comingFrom=f?f:"unknow";var aUp=IOL.adv.profile.up.value.up.split("-");if(aUp.length>0){IOL.adv.profile.up.value.age=(aUp[0])?aUp[0]:'0';IOL.adv.profile.up.value.gender=(aUp[1])?aUp[1]:'0';IOL.adv.profile.up.value.province=(aUp)?aUp[2]:'0';}IOL.adv.profile.up.value.isMinor=(IOL.adv.profile.up.value.age=="x")?true:false;IOL.adv.tools.logger(JSON.stringify(IOL.adv.profile.up.value)+", coming from: "+f,classFunc);},geoedgeCondition:function(){var classFunc=IOL.adv.settings.classname+".geoedgeCondition";var b=(IOL.adv.pageWidth<=640||IOL.adv.browser=='safari'||IOL.adv.pubAdsCfg.antiMalware)?true:false;IOL.adv.tools.logger("geoedge condition: "+b,classFunc);return b;},pbjsHybridCondition:function(){var classFunc=IOL.adv.tools.classname+".pbjsHybridCondition";var condition=false;if(IOL.adv.settings.hasOwnProperty("pbjsHybrid")){condition=(IOL.adv.settings.pbjsHybrid.hasOwnProperty("condition"))?(typeof IOL.adv.settings.pbjsHybrid.condition==="function")?IOL.adv.settings.pbjsHybrid.condition():false:(IOL.adv.pageWidth<=728)}IOL.adv.tools.logger("pbjsHybrid condition: "+condition,classFunc);return condition;},getDevice:function(){if(IOL.adv.pageWidth>0&&IOL.adv.pageWidth<728)return"mobile";if(IOL.adv.pageWidth>727&&IOL.adv.pageWidth<1024)return"tablet";return"desktop";}}}if(!window.iamInitialized){IOL.adv.cookie={get:function(name,force){var ret=false;if(!IOL.adv.deviceAccess.enable&&!force)return ret;var aCookieName=name.split(',');var aCookie=document.cookie.split(';');var l=aCookie.length;for(var j=0;j<aCookieName.length;j++){var nameEQ=aCookieName[j]+"=";for(var i=0;i<l;i++){var c=aCookie[i];while(c.charAt(0)==' '){c=c.substring(1,c.length);}if(c.indexOf(nameEQ)===0){ret=c.substring(nameEQ.length,c.length);}}}return ret;},getProfileEnable:function(){if(IOL.adv.gdpr.tcfv20.pipeline.policyCookie){var cValue=IOL.adv.cookie.get(IOL.adv.gdpr.tcfv20.pipeline.policyCookie);return(cValue=='on')?true:false;}var cValue=IOL.adv.cookie.get('policy_cookie');if(!cValue)return false;else{return(cValue[3]=='1'?true:false);}},set:function(cName,cValue,cDays,cPath,cDomain,force){if(!IOL.adv.deviceAccess.enable&&!force)return;var expires=new Date();expires.setDate(expires.getDate()+cDays);document.cookie=cName+"="+escape(cValue)+((cDays===null)?"":"; expires="+expires.toUTCString())+"; Secure; SameSite=Strict; path="+((typeof cPath==="undefined")?"/":cPath)+"; domain="+((cDomain)?cDomain:IOL.adv.domain);},erase:function(cName,cDomain){document.cookie=cName+'=; Max-Age=0; path=/; domain='+((cDomain)?cDomain:IOL.adv.domain);},enabled:function(){if(!IOL.adv.deviceAccess.enable)return false;this.set(IOL.adv.domain,"probe","ok",1);var enabled=this.get("probe")=='ok';this.set(IOL.adv.domain,"probe","",-1);return enabled;}}}if(!window.iamInitialized){IOL.adv.settings={classname:"IOL.adv.settings",ns:"libero.web.webmail.login.1.1",modules:{"aax":false,"trkPerf":false},library:{"geoedge":{enable:true,mandatory:false,url:"//rumcdn.geoedge.be/grumi-ip.js",live:false,condition:"(IOL.adv.pageWidth<=640 || IOL.adv.connectionType!='4g')"},"platform":{enable:true,mandatory:true,url:"//securepubads.g.doubleclick.net/tag/js/gpt.js",live:false},"prebid":{enable:false,mandatory:false,url:"//www.iolam.it/js/prebid.js",live:false,condition:function(){return IOL.adv.pubAdsCfg.prebid}},"amazon":{enable:false,mandatory:false,url:"//c.amazon-adsystem.com/aax2/apstag.js",live:false,condition:function(){return IOL.adv.pubAdsCfg.prebid}},"intersectionObserver":{enable:true,mandatory:false,url:"//www.iolam.it/js/polyfill/intersection-observer.js",live:false,condition:function(){return typeof IntersectionObserver!=='function'&&IOL.adv.pubAdsCfg.lazy}}},dmp:{"1plusx":{"tagger":{enable:false,url:"https://cdn.opecloud.com/ope-italiaonline.js"},"api":{enable:true,url:"//italiaonline.profiles.tagger.opecloud.com/v1/targeting"}}},disableInitialLoad:true,enableSingleRequest:true,enableAsyncRendering:true,lazy:{observer:{obj:null,options:{threshold:[0.001],rootMargin:"400px 0px 400px 0px"}},divIdSlotIdMap:{}},slots:{"default":{fnInit:'IOL.adv.settings.fnInit()',ads:{"adsplash":{adUnitPath:"/5180/libero/webmail/login",divId:"adsplash",optional:"true",size:[[1540,1024]],validRangeSize:{"desktop":{minW:981,maxW:9999}},setCollapseEmptyDiv:[true,false],forceSafeFrame:false,bidAmazon:false,fnBefore:'IOL.adv.settings.fnBeforeAdSplash(id,ad)',fnAfter:'IOL.adv.settings.fnAfterAdSplash(id, ad)',},"adleaderboard":{adUnitPath:"/5180/libero/webmail/login",divId:"adleaderboard",optional:"true",size:[[728,90]],validRangeSize:{"tablet":{minW:731,maxW:980}},setCollapseEmptyDiv:[true,false],forceSafeFrame:false,bidAmazon:false,fnBefore:'IOL.adv.settings.fnBeforeAdLeaderboard(id,ad)',fnAfter:false},"admpu":{adUnitPath:"/5180/libero/webmail/login",divId:"admpu",optional:"true",size:[[300,250],[600,800]],validRangeSize:{"mobile":{minW:320,maxW:730}},setCollapseEmptyDiv:[true,false],forceSafeFrame:false,bidAmazon:false,fnBefore:'IOL.adv.settings.fnBeforeAdMpu(id,ad)',fnAfter:false}},fnFinally:false},"test":{fnInit:'IOL.adv.settings.fnInit()',ads:{"adsplash":{adUnitPath:"/5180/testiol/libero/login/test%PLACEHOLDER%",divId:"adsplash",optional:"true",size:[[1540,1024]],validRangeSize:{"desktop":{minW:981,maxW:9999}},setCollapseEmptyDiv:[true,false],forceSafeFrame:false,bidAmazon:false,fnBefore:'IOL.adv.settings.fnBeforeAdSplash(id,ad)',fnAfter:'IOL.adv.settings.fnAfterAdSplash(id, ad)',},"adleaderboard":{adUnitPath:"/5180/testiol/libero/login/test%PLACEHOLDER%",divId:"adleaderboard",optional:"true",size:[[728,90]],validRangeSize:{"tablet":{minW:731,maxW:980}},setCollapseEmptyDiv:[true,false],forceSafeFrame:false,bidAmazon:false,fnBefore:'IOL.adv.settings.fnBeforeAdLeaderboard(id,ad)',fnAfter:false},"admpu":{adUnitPath:"/5180/testiol/libero/login/test%PLACEHOLDER%",divId:"admpu",optional:"true",size:[[300,250],[600,800]],validRangeSize:{"mobile":{minW:320,maxW:730}},setCollapseEmptyDiv:[true,false],forceSafeFrame:false,bidAmazon:false,fnBefore:'IOL.adv.settings.fnBeforeAdMpu(id,ad)',fnAfter:false}},fnFinally:false}},fnInit:function(){var classFunc=IOL.adv.settings.classname+".fnInit";try{if(typeof(pubAdsCfg.location)=="string"){if(pubAdsCfg.location=="step1"){IOL.adv.tools.logger("step1: remove items",classFunc);sessionStorage.removeItem('adv_st_active');sessionStorage.removeItem('adv_st_storyid');}if(pubAdsCfg.location=="step2"){if(sessionStorage.getItem('adv_st_active')=='yes'){var googletag=window.googletag||{};googletag.cmd=googletag.cmd||[];googletag.cmd.push(function(){var storyId=sessionStorage.getItem('adv_st_storyid')?sessionStorage.getItem('adv_st_storyid'):false;if(storyId){IOL.adv.tools.logger("step2: call setTargeting adv_st_active, adv_st_storyid: "+storyId,classFunc);googletag.pubads().setTargeting("adv_st_active","yes");googletag.pubads().setTargeting("adv_st_storyid",storyId);}else
IOL.adv.tools.logger("step2: adv_st_storyid not found",classFunc);});}else
IOL.adv.tools.logger("step2: adv_st_active not found",classFunc);}}}catch(e){IOL.adv.tools.logger("Some problems here, e: "+e.message,classFunc,'error');}},fnAfterAdSplash:function(id,ad){googletag.pubads().addEventListener('slotRenderEnded',function(event){var classFunc=IOL.adv.settings.classname+".fnAfterAdSplash";try{var slotId=event.slot.getSlotElementId();IOL.adv.tools.logger("slotId: "+slotId+" ad.divId: "+ad.divId+" event.isEmpty: "+event.isEmpty,classFunc);if(slotId==ad.divId&&!event.isEmpty&&event.size){var w=event.size[0];if(IOL.adv.headerBidding.prebidjs.enable){Object.keys(pbjs.getAllWinningBids()).forEach(function(key){IOL.adv.tools.logger("HeaderBidding Winning Bids: "+pbjs.getAllWinningBids()[key].adUnitCode,classFunc);if(pbjs.getAllWinningBids()[key].adUnitCode==ad.divId){w=pbjs.getAllWinningBids()[key].width;IOL.adv.tools.logger("Get size from HeaderBidding Winning Bids",classFunc);}});}IOL.adv.tools.logger("ads width: "+w,classFunc);if(w==300){IOL.adv.tools.logger("Calling get_editorial function",classFunc);get_editorial();}}}catch(e){}});},fnFinally:function(){var classFunc=IOL.adv.settings.classname+".fnFinally";},fnBeforeAdSplash:function(id,ad){var classFunc=IOL.adv.settings.classname+".fnBeforeAdSplash";if(!IOL.adv.gdpr.consentGoogle)ad.setCollapseEmptyDiv=[false,true];try{if(pubAdsCfg.location!='undefined')ad.adUnitPath=ad.adUnitPath.concat("/"+pubAdsCfg.location);if((typeof pubAdsCfg.location!='undefined')&&((typeof(sessionStorage.getItem('adv_st_active'))!=='string')||(sessionStorage.getItem('adv_st_active')!=='yes'))){ad.size=[[1540,1024],[300,600]];}}catch(e){}},fnBeforeAdLeaderboard:function(id,ad){var classFunc=IOL.adv.settings.classname+".fnBeforeAdLeaderboard";if(!IOL.adv.gdpr.consentGoogle)ad.setCollapseEmptyDiv=[false,true];try{if(pubAdsCfg.location!='undefined')ad.adUnitPath=ad.adUnitPath.concat("/"+pubAdsCfg.location);}catch(e){}},fnBeforeAdMpu:function(id,ad){var classFunc=IOL.adv.settings.classname+".fnBeforeAdMpu";if(!IOL.adv.gdpr.consentGoogle)ad.setCollapseEmptyDiv=[false,true];try{if(pubAdsCfg.location!='undefined')ad.adUnitPath=ad.adUnitPath.concat("/"+pubAdsCfg.location);}catch(e){}},}}if(!window.iamInitialized){IOL.adv.manager={classname:"IOL.adv.manager",divIdReady:false,divIdReadyList:[],slotsContainer:[],refreshSlotsContainer:[],originalSlotsContainer:[],divIdAdsIdMap:{},lastSlotIdReady:"",videoAds:false,videoOnly:false,deferredIteration:0,deferredMaxIteration:1000,deferredInterval:20,deferredTimer:null,customCriteria:{map:{},set:[],duration:""},init:function init(fn){var classFunc=IOL.adv.manager.classname+".init";IOL.adv.tools.logger("Start function",classFunc);try{if(typeof IamCallbackInitialize==="function"){IOL.adv.tools.logger("Hook IamCallbackInitialize",classFunc);IamCallbackInitialize();}}catch(e){}Object.keys(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads).forEach(function(id){var ad=IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id];ad.id=id;ad.mediaType=(ad.mediaType!==undefined)?ad.mediaType:'display';ad.size=(ad.size==undefined)?[]:ad.size;ad.lazy=(ad.lazy!==undefined)?ad.lazy:true;ad.optional=(ad.optional!==undefined)?ad.optional:false;ad.customCriteria=(ad.customCriteria!==undefined)?ad.customCriteria:false;ad.sizeIsCompliant=true;ad.onRenderEnded=(ad.onRenderEnded!==undefined)?Array.isArray(ad.onRenderEnded)?ad.onRenderEnded:Array(ad.onRenderEnded):[];ad.refresh=(ad.refresh!==undefined)?ad.refresh:{"ts":false,"gap":500};if(ad.mediaType=='video')ad.size=[[640,480]];if(ad.validRangeSize){IOL.adv.tools.logger(id+" :: validRangeSize has been requested",classFunc);IOL.adv.tools.validRangeSize(IOL.adv.pageWidth,ad,id);}if(ad.divIdSwap){IOL.adv.tools.logger(id+" :: divIdSwap has been requested",classFunc);IOL.adv.tools.divIdSwap(IOL.adv.pageWidth,ad,id);}IOL.adv.manager.divIdAdsIdMap[ad.divId]=id;});Object.keys(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads).forEach(function(id){var ad=IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id];if(!ad.divIdReady&&ad.mediaType=='display'){ad.divIdReady=IOL.adv.tools.divIdReady(ad);if(!ad.divIdReady){IOL.adv.tools.logger("ads container: "+ad.divId+" is not ready, disable ads. Optional: "+((ad.optional!==true)?false:true),classFunc,"warning");IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id].mediaType="disabledDivIdNotReady";if(IOL.adv.settings.hasOwnProperty("prebidjs"))if(IOL.adv.settings.prebidjs.hasOwnProperty("adUnits"))IOL.adv.settings.prebidjs.adUnits=IOL.adv.settings.prebidjs.adUnits.filter(IOL.adv.headerBidding.rmAdunitByCode,{code:ad.divId});if(ad.optional!==true)IOL.adv.tools.track({e:"error.divIdDoesNotExist",div:ad.divId,t:Math.floor(performance.now()),lv:"warning"});}else
IOL.adv.tools.logger("ads container: "+ad.divId+" is ready :: config :: "+JSON.stringify(ad),classFunc);}});if(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].fnInit){if(!IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].fnInitDone){IOL.adv.tools.logger("Run fnInit on slot: "+IOL.adv.pubAdsCfg.slot+" using function: "+IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].fnInit,classFunc);IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].fnInitDone=true;eval(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].fnInit);}}if(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].sliderContainer)if(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].sliderContainer.fnInit){IOL.adv.tools.logger("Run fnInit on slot: "+IOL.adv.pubAdsCfg.slot+" using function: "+IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].sliderContainer.fnInit,classFunc);eval(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].sliderContainer.fnInit);}Object.keys(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads).forEach(function(id){var ad=IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id];if(ad.mediaType=='display'){if(ad.fnBefore){IOL.adv.tools.logger(id+" run fnBefore",classFunc);eval(ad.fnBefore);}ad.adUnitPath=IOL.adv.getAdUnitPath(id,false,classFunc);}});var adsCount=Object.keys(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads).filter(function(i){if(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[i].mediaType=='display')return true;}).length;IOL.adv.tools.logger("number of defined ads: "+adsCount,classFunc);if(adsCount==0){IOL.adv.complete=true;IOL.adv.tools.logger("IAM complete",classFunc);}else
fn();IOL.adv.tools.asHandler("tagger");},run:function(){var classFunc=IOL.adv.manager.classname+".run";IOL.adv.tools.logger("Start function. ",classFunc);IOL.adv.pubAdsCfg.lazy=IOL.adv.pubAdsCfg.lazy&&(typeof IntersectionObserver==='function'&&typeof IOL.adv.settings.lazy!=='undefined')?true:false;if(IOL.adv.pubAdsCfg.lazy){IOL.adv.settings.enableAsyncRendering=true;IOL.adv.settings.disableInitialLoad=true;IOL.adv.tools.logger("Lazy enable, init IntersectionObserver",classFunc);IOL.adv.settings.lazy.observer.obj=new IntersectionObserver(function onEntry(entries){var l=entries.length;for(var i=0;i<l;i++){var entry=entries[i];IOL.adv.tools.logger("IntersectionObserver: div: "+entry.target.id+", ratio: "+entry.intersectionRatio,classFunc);if(entry.intersectionRatio>0){IOL.adv.tools.logger("IntersectionObserver: "+entry.target.id+" is visible, remove observer, display ads",classFunc);IOL.adv.settings.lazy.observer.obj.unobserve(document.getElementById(entry.target.id));var slotId=IOL.adv.settings.lazy.divIdSlotIdMap[entry.target.id];IOL.adv.tools.displayAds({slotId:slotId,changeCorrelator:false});}}},IOL.adv.settings.lazy.observer.options);}var adUnits=[];if(IOL.adv.settings.hasOwnProperty("prebidjs"))if(IOL.adv.settings.prebidjs.hasOwnProperty("adUnits"))adUnits=IOL.adv.settings.prebidjs.adUnits.filter(function(e){var b=false;if(e.mediaTypes.hasOwnProperty("video"))if(e.mediaTypes.video.hasOwnProperty("context"))if(e.mediaTypes.video.context=='outstream')b=true;if(e.mediaTypes.hasOwnProperty("banner")||e.mediaTypes.hasOwnProperty("native"))b=true;if(b){IOL.adv.tools.logger("adUnits.filter add: "+e.code,classFunc);return true;}else
IOL.adv.tools.logger("adUnits.filter discard: "+e.code,classFunc);});var ads={};Object.keys(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads).forEach(function(id){var ad=IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id];if(ad.mediaType=='display'){ads[id]=ad;if(ad.mgid){IOL.adv.tools.logger(ad.divId+": mgid found",classFunc);IOL.adv.tools.displayMgid(ad,"asFirst",function(){return!IOL.adv.gdpr.consentGoogle&&!IOL.adv.pubAdsCfg.deferredDisplay&&(ad.mgid.mode=="asFirst"||!IOL.adv.headerBidding.enable)},function(){IOL.adv.tools.logger(id+": disable hb, use mgid for this ads",classFunc);ad.bidAmazon=false;adUnits=adUnits.filter(function(bid){return bid.code!=ad.divId;});},classFunc);}if(ad.ketai){IOL.adv.tools.logger(ad.divId+": ketai found",classFunc);IOL.adv.tools.displayKetai(ad,"asFirst",function(){return!IOL.adv.gdpr.consentGoogle&&!IOL.adv.pubAdsCfg.deferredDisplay&&(ad.ketai.mode=="asFirst"||!IOL.adv.headerBidding.enable)},function(){IOL.adv.tools.logger(id+": disable hb, use ketai for this ads",classFunc);ad.bidAmazon=false;adUnits=adUnits.filter(function(bid){return bid.code!=ad.divId;});},classFunc);}}});if(!IOL.adv.pubAdsCfg.deferredRun&&!IOL.adv.settings.deferredHeaderBidding){IOL.adv.headerBidding.init(ads,adUnits,function(){IOL.adv.headerBidding.run()});}var googletag=window.googletag||{};googletag.cmd=googletag.cmd||[];googletag.cmd.push(function(){IOL.adv.tools.logger("Start googletag.cmd.push",classFunc);var companionVideo=false;IOL.adv.settings.disableInitialLoad?googletag.pubads().disableInitialLoad():false;IOL.adv.settings.enableSingleRequest?googletag.pubads().enableSingleRequest():false;IOL.adv.settings.enableAsyncRendering?googletag.pubads().enableAsyncRendering():false;Object.keys(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads).forEach(function(id){IOL.adv.tools.logger("Start manage ads "+id,classFunc);var ad=IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id];if(ad.mediaType=='display'){IOL.adv.tools.logger(ad.divId+" is ready, run googletag defineSlot",classFunc);if(IOL.adv.pubAdsCfg.lazy&&ad.lazy!==false)ad.setCollapseEmptyDiv=[false,false];if(ad.onRenderEnded){try{ad.onRenderEnded.forEach(function(e){IOL.adv.tools.logger("found onRenderEnded for "+ad.divId,classFunc);e.condition=(e.condition)?e.condition:'default';e.allowedSizes=(e.allowedSizes)?Array.isArray(e.allowedSizes)?e.allowedSizes:Array(e.allowedSizes):[];IOL.adv.tools.onRenderEnded(ad,e);})}catch(e){}}IOL.adv.manager.lastSlotIdReady=id;if(ad.outOfPage){if(ad.interstitial){IOL.adv.manager.slotsContainer[id]=googletag.defineOutOfPageSlot(ad.adUnitPath.trim(),googletag.enums.OutOfPageFormat.INTERSTITIAL);if(IOL.adv.manager.slotsContainer[id]){IOL.adv.manager.slotsContainer[id].addService(googletag.pubads());IOL.adv.tools.logger("interstitial supported for ads container: "+ad.divId,classFunc);}else{IOL.adv.tools.logger("interstitial not supported for ads container: "+ad.divId+", discard this slot",classFunc);return;}}else
IOL.adv.manager.slotsContainer[id]=googletag.defineOutOfPageSlot(ad.adUnitPath.trim(),ad.divId).addService(googletag.pubads());}else{IOL.adv.manager.slotsContainer[id]=googletag.defineSlot(ad.adUnitPath.trim(),ad.size,ad.divId).addService(googletag.pubads());}if(ad.customCriteria)ad.customCriteria.forEach(function(c){Object.keys(c).forEach(function(k){IOL.adv.manager.slotsContainer[id].setTargeting(k,c[k]);});});if(ad.companionVideo){IOL.adv.tools.logger("Ads settings of "+id+" :: companionVideo: "+ad.companionVideo,classFunc);companionVideo=true;IOL.adv.manager.slotsContainer[id].addService(googletag.companionAds());}ad.setCollapseEmptyDiv?IOL.adv.manager.slotsContainer[id].setCollapseEmptyDiv(ad.setCollapseEmptyDiv[0],ad.setCollapseEmptyDiv[1]):false;if(ad.sizeMapping){IOL.adv.tools.logger("Start define sizeMapping for "+ad.divId,classFunc);var sizeMapping=googletag.sizeMapping();Object.keys(ad.sizeMapping).forEach(function(dimension){IOL.adv.tools.logger(ad.divId+" enable sizeMapping for dimension: "+dimension+" with size: "+ad.sizeMapping[dimension][0]+" :: "+ad.sizeMapping[dimension][1],classFunc);sizeMapping.addSize(ad.sizeMapping[dimension][0],ad.sizeMapping[dimension][1]);});if(sizeMapping)IOL.adv.manager.slotsContainer[id].defineSizeMapping(sizeMapping.build());}if(ad.forceSafeFrame){IOL.adv.manager.slotsContainer[id].setForceSafeFrame(true);googletag.pubads().setSafeFrameConfig({sandbox:true});}if(ad.fnAfter){IOL.adv.tools.logger(ad.divId+" run fnAfter",classFunc);eval(ad.fnAfter);}}else
IOL.adv.tools.logger(id+" is a video ads.",classFunc);});if(IOL.adv.pubAdsCfg.gptlazy){IOL.adv.tools.logger("Run googletag.enableLazyLoad",classFunc);googletag.pubads().enableLazyLoad({fetchMarginPercent:-1,renderMarginPercent:200,mobileScaling:2.0});}if(companionVideo){IOL.adv.tools.logger("companionVideo, run enableVideoAds",classFunc);googletag.companionAds().setRefreshUnfilledSlots(false);googletag.pubads().enableVideoAds();}IOL.adv.tools.logger("Run googletag.enableServices",classFunc);googletag.enableServices();if(!IOL.adv.headerBidding.enable&&!IOL.adv.pubAdsCfg.deferredRun){if(IOL.adv.pubAdsCfg.lazy){IOL.adv.tools.logger("Start Lazy loading in standard mode",classFunc);Object.keys(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads).forEach(function(id){var ad=IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id];if(ad.mediaType=='display')if(ad.lazy==false){IOL.adv.tools.logger(ad.divId+", lazy disable for this ads, start display",classFunc);IOL.adv.tools.displayAds({slotId:id,changeCorrelator:false});}else{IOL.adv.tools.logger(ad.divId+", lazy enabled for this ads, start intersectionObserver",classFunc);var d=IOL.adv.tools.divIdReady(ad,true);if(d){IOL.adv.settings.lazy.observer.obj.observe(d);IOL.adv.settings.lazy.divIdSlotIdMap[ad.divId]=id;}}});}else{IOL.adv.tools.logger("Ads start displayAds in standard mode for slot: "+IOL.adv.pubAdsCfg.slot,classFunc);if(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads.admputop)IOL.adv.tools.trkPerf("iamRenderingStartMpuTop",Math.floor(performance.now()));IOL.adv.tools.displayAds();}try{if(typeof IamCallbackOnComplete==="function"){IOL.adv.tools.logger("Hook IamCallbackOnComplete. HeaderBidding is disable",classFunc);IamCallbackOnComplete();}}catch(e){}}if(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].fnFinally){IOL.adv.tools.logger("Run fnFinally on slot: "+IOL.adv.pubAdsCfg.slot+" using function: "+IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].fnFinally,classFunc);eval(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].fnFinally);}if(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].sliderContainer)if(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].sliderContainer.fnFinally){IOL.adv.tools.logger("Run fnFinally on slot: "+IOL.adv.pubAdsCfg.slot+" using function: "+IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].sliderContainer.fnFinally,classFunc);eval(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].sliderContainer.fnFinally);}if(IOL.adv.pubAdsCfg.deferredRun){IOL.adv.complete=true;IOL.adv.tools.logger("IAM complete",classFunc);}if(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads.admputop){googletag.pubads().addEventListener('slotRequested',function(event){try{var slot=event.slot;if(slot.getSlotElementId()===IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads.admputop.divId){IOL.adv.tools.logger('track slotRequested for slot: '+slot.getSlotElementId(),classFunc);IOL.adv.tools.trkPerf("iamSlotRequestedMpuTop",Math.floor(performance.now()));}}catch(e){}});}if(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads.admputop){googletag.pubads().addEventListener('slotOnload',function(event){try{var slot=event.slot;if(slot.getSlotElementId()===IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads.admputop.divId){IOL.adv.tools.logger('track slotOnload for slot: '+slot.getSlotElementId(),classFunc);IOL.adv.tools.trkPerf("iamSlotOnLoadMpuTop",Math.floor(performance.now()));}}catch(e){}});}if(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads.admputop){googletag.pubads().addEventListener('slotResponseReceived',function(event){try{var slot=event.slot;if(slot.getSlotElementId()===IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads.admputop.divId){IOL.adv.tools.logger('track slotOnload for slot: '+slot.getSlotElementId(),classFunc);IOL.adv.tools.trkPerf("iamSlotResponseReceivedMpuTop",Math.floor(performance.now()));}}catch(e){}});}if(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads.admputop){googletag.pubads().addEventListener('slotRenderEnded',function(event){try{var slot=event.slot;if(slot.getSlotElementId()===IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads.admputop.divId){IOL.adv.tools.logger('track slotRenderEnded for slot: '+slot.getSlotElementId(),classFunc);IOL.adv.tools.trkPerf("iamSlotRenderEndedMpuTop",Math.floor(performance.now()));}}catch(e){}});}googletag.pubads().addEventListener('slotRenderEnded',function(event){try{var trackMaxCPM=true&&IOL.adv.headerBidding.prebidjs.enable;if(trackMaxCPM){var cpms={};var bids=pbjs.getHighestCpmBids();for(var i=0;i<bids.length;i++){var cpm={};cpm[bids[i].cpm]={"id":bids[i].adUnitCode,"size":bids[i].size,"bidder":bids[i].bidder};cpms=IOL.adv.tools.extend(cpms,cpm)}var maxCpm=Math.max.apply(null,Object.keys(cpms));if(cpms[maxCpm])IOL.adv.tools.track({e:"hb.cpm",key:"hb.cpm."+cpms[maxCpm].bidder,div:cpms[maxCpm].id+"."+cpms[maxCpm].size,t:Math.round(maxCpm*100000)/100000,lv:"info"});}if(event.isEmpty||event.advertiserId=='38840327'){var slotId=event.slot.getSlotElementId();IOL.adv.tools.logger(slotId+" : call displayPrebidOnDemand, ads is "+((event.isEmpty)?"empty":("autopromo:advertiserId:"+event.advertiserId)),classFunc);IOL.adv.tools.displayPrebidOnDemand(slotId,"defaultRendering");}IOL.adv.tools.trkPerf("iamRenderingEnd",Math.floor(performance.now()),true);IOL.adv.tools.track({e:"time.rendering",key:"time.rendering.gpt."+((IOL.adv.headerBidding.prebidjs.bids)?"bids":"nobids"),t:Math.floor(performance.now()),lv:"info"});if(typeof IamCallbackSlotRenderEnded==="function"){IOL.adv.tools.logger("Hook IamCallbackSlotRenderEnded for "+event.slot.getSlotElementId(),classFunc);IamCallbackSlotRenderEnded();}}catch(e){IOL.adv.tools.logger("error in googletag.cmd.push:"+e.message,classFunc,"error");}});IOL.adv.tools.logger("End function. ",classFunc);});},setCustomCriteria:function(){var classFunc=IOL.adv.manager.classname+".setCustomCriteria";IOL.adv.tools.logger("Start function",classFunc);var consentString=IOL.adv.getConsentString();var customCriteriaMap={"oe":{condition:typeof document.characterSet==='string',value:document.characterSet,otherwise:"UTF-8"},"optout":{condition:IOL.adv.profile.enable,value:"0",otherwise:"1"},"adv_infocus":{condition:IOL.adv.hasFocus,value:"yes",otherwise:"no"},"adv_np":{condition:IOL.adv.cookie.get('ADV_NP'),value:"yes"},"adv_topics":{condition:IOL.adv.topics.length>0,value:IOL.adv.topics},"adv_referrer":{condition:true,value:IOL.adv.referrerLabel},"adv_sgt":{condition:true,value:IOL.adv.tools.randomInt(1,4)},"pbjs_version":{condition:IOL.adv.headerBidding.prebidjs.enable,value:IOL.adv.headerBidding.prebidjs.version},"native":{condition:IOL.adv.pubAdsCfg.native!==false,value:IOL.adv.pubAdsCfg.native},"is_native":{condition:IOL.adv.pubAdsCfg.native!==false,value:((IOL.adv.pubAdsCfg.native!=='')?"yes":"no"),otherwise:"no"},"1plusx":{condition:IOL.adv.profile.enable&&!IOL.adv.profile.up.value.isMinor&&IOL.adv.profile.as.value.s.length>0,value:IOL.adv.profile.as.value.s},"ctx1plusx":{condition:IOL.adv.profile.as.value.t.length>0,value:IOL.adv.profile.as.value.t},"xdid_user":{condition:IOL.adv.getProfile("ppid.iol"),value:"true"},"xdid_user_ui":{condition:((IOL.adv.profile.up.value.ui)==1),value:"true",otherwise:"false"},"adv_sso1":{condition:IOL.adv.profile.enable&&IOL.adv.profile.up.value.age,value:IOL.adv.profile.up.value.age,otherwise:"0"},"adv_sso2":{condition:IOL.adv.profile.enable&&IOL.adv.profile.up.value.gender,value:IOL.adv.profile.up.value.gender,otherwise:"0"},"adv_sso3":{condition:IOL.adv.profile.enable&&IOL.adv.profile.up.value.province,value:IOL.adv.profile.up.value.province,otherwise:"0"},"seat_keyword":{condition:IOL.adv.profile.enable&&IOL.adv.profile.up.value.ext.seat_keyword,value:IOL.adv.profile.up.value.ext.seat_keyword},"us_ua":{condition:IOL.adv.profile.up.value.isMinor,value:"true",otherwise:"false"},"gdpr":{condition:consentString!=false,value:"1",otherwise:"0"},"gdpr_consent":{condition:consentString!='',value:consentString},"kw_test":{condition:IOL.adv.tools.getParameterByName("kw_test")!==null,value:IOL.adv.tools.getParameterByName("kw_test")},"siz_hostname":{condition:true,value:IOL.adv.hostname},"siz_devicetype":{condition:true,value:IOL.adv.device}};if(IOL.adv.pubAdsCfg.customCriteria){Object.keys(IOL.adv.pubAdsCfg.customCriteria).forEach(function(k){IOL.adv.tools.logger("Manage client customCriteria: "+k+" value:"+IOL.adv.pubAdsCfg.customCriteria[k],classFunc);if(IOL.adv.pubAdsCfg.customCriteria[k]!==''){customCriteriaMap[k]={condition:false,value:false};customCriteriaMap[k].condition=true;customCriteriaMap[k].value=String(IOL.adv.pubAdsCfg.customCriteria[k]).replace(/\|/g,",");}});}IOL.adv.manager.customCriteria.map=IOL.adv.tools.extend(IOL.adv.manager.customCriteria.map,customCriteriaMap);if(IOL.adv.profile.up.value.isMinor){delete IOL.adv.manager.customCriteria.map.adv_sso1;delete IOL.adv.manager.customCriteria.map.adv_sso2;delete IOL.adv.manager.customCriteria.map.adv_sso3;}Object.keys(IOL.adv.manager.customCriteria.map).forEach(function(t){IOL.adv.tools.logger("Manage Target: "+t+" :: condition: "+IOL.adv.manager.customCriteria.map[t].condition+" :: value: "+IOL.adv.manager.customCriteria.map[t].value+" :: otherwise: "+IOL.adv.manager.customCriteria.map[t].otherwise,classFunc);if(IOL.adv.manager.customCriteria.map[t].condition&&IOL.adv.manager.customCriteria.map[t].value!==undefined){var v=String(IOL.adv.manager.customCriteria.map[t].value);IOL.adv.manager.customCriteria.set[t]=v;IOL.adv.tools.logger("Condition is true for Target: "+t+" :: assign value: "+v,classFunc);googletag.pubads().setTargeting(t,v);}else if(IOL.adv.manager.customCriteria.map[t].otherwise){googletag.pubads().setTargeting(t,IOL.adv.manager.customCriteria.map[t].otherwise);IOL.adv.manager.customCriteria.set[t]=IOL.adv.manager.customCriteria.map[t].otherwise;IOL.adv.tools.logger("Condition is false, otherwise is configured for Target: "+t+" :: assign value: "+IOL.adv.manager.customCriteria.map[t].otherwise,classFunc);}else
IOL.adv.tools.logger("Condition is false, otherwise is not configured for Target: "+t+", custom criteria has not been set",classFunc);});IOL.adv.tools.logger("end function",classFunc);},createAds:function(id,idx){var classFunc=IOL.adv.manager.classname+".createAds";IOL.adv.tools.logger("Start function",classFunc);var idx=(idx)?idx:0;try{if(!IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].dynamic.enable||!id)return;var adUnitPathSuffix=idx+1;var separator=(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].dynamic.hasOwnProperty("customSepator"))?IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].dynamic.customSepator:"/";IOL.adv.mode="dynamic";IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id]={};IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id].divId=id;IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id].adUnitPath=IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].dynamic.adUnitPath+separator+adUnitPathSuffix;IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id].size=IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].dynamic.size;IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id].mediaType='display';IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id].optional=true;IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id].sizeIsCompliant=true;IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id].forceSafeFrame=false;IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id].ketai=((IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].dynamic.ketai)?IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].dynamic.ketai:false);IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id].customCriteria=((IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].dynamic.customCriteria)?IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].dynamic.customCriteria:false);IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id].bidAmazon=true;IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id].fnBefore=((IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].dynamic.fnBefore)?IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].dynamic.fnBefore:false);IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id].fnAfter=((IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].dynamic.fnAfter)?IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].dynamic.fnAfter:false);IOL.adv.tools.logger("Create dynamic ads with id: "+id+", idx: "+idx,classFunc);if(IOL.adv.headerBidding.enable&&IOL.adv.settings.prebidjs.dynamicAdUnits){if(IOL.adv.settings.prebidjs.dynamicAdUnits[idx]){IOL.adv.settings.prebidjs.dynamicAdUnits[idx].code=IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id].divId;IOL.adv.settings.prebidjs.adUnits.push(Object.assign({},IOL.adv.settings.prebidjs.dynamicAdUnits[idx]));IOL.adv.tools.logger("Prebid adUnit code found for ads: "+id,classFunc);}else
IOL.adv.tools.logger("Prebid adUnit code not found for ads: "+id,classFunc);}else
IOL.adv.tools.logger("Prebid disabled for ads: "+id,classFunc);IOL.adv.tools.logger("End function",classFunc);}catch(e){}}}}if(!window.iamInitialized){IOL.adv.headerBidding={classname:"IOL.adv.headerBidding",enable:true,bids:false,hbTimeout:2000,bidderTimeout:1500,supplyChainSid:"54356",bidders:[],requestManager:{adServerRequestSent:false,timer:false,timedOut:false},amazon:{id:'amazon',enable:false,init:false,pubID:'3204',adServer:'googletag',deals:true,videoAdServer:'DFP',excludeSizes:[[1,1],[320,100],[336,250],[336,280],[728,1],[970,270]],slots:[],slotsDisplay:[],slotsVideo:[],bids:false,videoBid:''},prebidjs:{id:'prebidjs',version:'0',enable:false,adUnits:[],bids:false,customConfigObject:{"buckets":[{"precision":2,"max":3,"increment":0.01},{"precision":2,"max":8,"increment":0.05},{"precision":2,"max":20,"increment":0.5},{"precision":2,"max":30,"increment":1}]},customSizeConfig:[{'mediaQuery':'(min-width: 1025px)','sizesSupported':[[1800,1000],[1200,90],[970,250],[970,90],[728,90],[640,480],[300,250],[300,600],[100,200],[1,1]],'labels':['desktop']},{'mediaQuery':'(min-width: 766px) and (max-width: 1024px)','sizesSupported':[[728,90],[640,480],[300,250],[300,600],[100,200],[1,1]],'labels':['tablet']},{'mediaQuery':'(min-width: 320px) and (max-width: 765px)','sizesSupported':[[640,300],[640,480],[300,250],[300,600],[300,50],[320,50],[320,100],[100,200],[1,1]],'labels':['mobile']}]},init:function(ads,adUnits,callback,fallback,pipeline){var classFunc=IOL.adv.headerBidding.classname+".init";IOL.adv.tools.logger("Start function",classFunc);IOL.adv.headerBidding.enable=false;IOL.adv.headerBidding.pipeline=(pipeline)?pipeline:"display";IOL.adv.headerBidding.amazon.enable=false;IOL.adv.headerBidding.amazon.slots=[];IOL.adv.headerBidding.amazon.slotsVideo=[];IOL.adv.headerBidding.amazon.slotsDisplay=[];IOL.adv.headerBidding.amazon.bids=false;IOL.adv.headerBidding.amazon.videoBid='';IOL.adv.headerBidding.prebidjs.enable=false;IOL.adv.headerBidding.prebidjs.bids=false;IOL.adv.headerBidding.bidders=[];IOL.adv.headerBidding.requestManager={};IOL.adv.headerBidding.requestManager.adServerRequestSent=false;IOL.adv.headerBidding.requestManager.timedOut=false;if(!IOL.adv.pubAdsCfg.prebid||!IOL.adv.gdpr.enable||IOL.adv.profile.up.value.isMinor){IOL.adv.tools.logger("HeaderBidding disabled",classFunc);if(callback)callback();if(fallback)fallback();return;}if(!adUnits)adUnits=[];if(IOL.adv.settings.hbTimeout){IOL.adv.tools.logger("override hbTimeout: "+IOL.adv.settings.hbTimeout,classFunc);IOL.adv.headerBidding.hbTimeout=IOL.adv.settings.hbTimeout;}if(IOL.adv.settings.bidderTimeout){IOL.adv.tools.logger("override bidderTimeout: "+IOL.adv.settings.bidderTimeout,classFunc);IOL.adv.headerBidding.bidderTimeout=IOL.adv.settings.bidderTimeout;}IOL.adv.tools.logger("HeaderBidding, start compliance check for Amazon.",classFunc);if(typeof apstag!=='undefined'&&IOL.adv.gdpr.consentString){Object.keys(ads).forEach(function(key){var ad=ads[key];var sizes=[];if(ad.size)sizes=ad.size.filter(IOL.adv.tools.filterArrayInArray,{'list':IOL.adv.headerBidding.amazon.excludeSizes});IOL.adv.tools.logger("HeaderBidding Amazon for "+key+" ::"+" ad.bidAmazon:"+ad.bidAmazon+", ad.mediaType:"+ad.mediaType+", ad.sizeIsCompliant:"+ad.sizeIsCompliant+", ad.divIdReady:"+ad.divIdReady+", sizes:"+sizes,classFunc);if(ad.bidAmazon&&ad.sizeIsCompliant&&ad.divIdReady&&sizes.length>0){IOL.adv.tools.logger("HeaderBidding Amazon enable for "+key,classFunc);if(ad.mediaType=="display"&&ad.bidAmazon=='multi-format'&&ad.hasOwnProperty("bidAmazonMultiFormatProperties")){var condition=true;if(ad.bidAmazonMultiFormatProperties.hasOwnProperty("condition")&&typeof ad.bidAmazonMultiFormatProperties.condition==="function")condition=ad.bidAmazonMultiFormatProperties.condition();var multiFormatProperties=(ad.bidAmazonMultiFormatProperties.hasOwnProperty("multiFormatProperties"))?ad.bidAmazonMultiFormatProperties.multiFormatProperties:ad.bidAmazonMultiFormatProperties
IOL.adv.tools.logger("condition "+condition+" on "+key+" for HeaderBidding Amazon multi-format",classFunc);if(condition){IOL.adv.headerBidding.amazon.slotsDisplay.push({slotID:ad.divId,slotName:ad.adUnitPath,mediaType:'multi-format',multiFormatProperties:multiFormatProperties});}else{sizes=multiFormatProperties.display.sizes.filter(IOL.adv.tools.filterArrayInArray,{'list':IOL.adv.headerBidding.amazon.excludeSizes});ad.bidAmazon=true}}if(ad.mediaType=="display"&&ad.bidAmazon==true){IOL.adv.tools.logger("HeaderBidding Amazon add display slot "+key,classFunc);IOL.adv.headerBidding.amazon.slotsDisplay.push({slotID:ad.divId,slotName:ad.adUnitPath,sizes:sizes});}if(ad.mediaType=="display"&&ad.bidAmazon=='outstream'){IOL.adv.tools.logger("HeaderBidding Amazon add outstream slot "+key,classFunc);IOL.adv.headerBidding.amazon.slotsDisplay.push({slotID:ad.divId,mediaType:'video'});}if(ad.mediaType=="video"){IOL.adv.headerBidding.amazon.slotsVideo.push({slotID:'videoSlot',mediaType:'video'});}}else
IOL.adv.tools.logger("HeaderBidding Amazon disable for "+key,classFunc);});if(IOL.adv.headerBidding.amazon.slotsDisplay.length>0)IOL.adv.headerBidding.amazon.slots=IOL.adv.headerBidding.amazon.slotsDisplay;else
IOL.adv.headerBidding.amazon.slots=IOL.adv.headerBidding.amazon.slotsVideo;if(IOL.adv.headerBidding.amazon.slots.length>0){IOL.adv.headerBidding.amazon.enable=true;IOL.adv.headerBidding.bidders.push(IOL.adv.headerBidding.amazon.id);IOL.adv.headerBidding.apstagInit();IOL.adv.tools.logger("HeaderBidding amazon compliant and initialized.",classFunc);}}else
IOL.adv.tools.logger("HeaderBidding amazon: apstag is not defined or consentString is false",classFunc);IOL.adv.tools.logger("HeaderBidding amazon enable: "+IOL.adv.headerBidding.amazon.enable,classFunc);IOL.adv.tools.logger("HeaderBidding, start compliance check for prebidjs.",classFunc);if(typeof pbjs!=='undefined'&&adUnits.length>0){IOL.adv.headerBidding.prebidjs.version=pbjs.version;IOL.adv.headerBidding.prebidjs.enable=true;IOL.adv.headerBidding.bidders.push(IOL.adv.headerBidding.prebidjs.id);pbjs.removeAdUnit();var improveKValue={keyValues:{adv_sso1:[(IOL.adv.profile.enable?(IOL.adv.profile.up.value.age?IOL.adv.profile.up.value.age:"0"):"0")],adv_sso2:[(IOL.adv.profile.enable?(IOL.adv.profile.up.value.gender?IOL.adv.profile.up.value.gender:"0"):"0")],gam_failover:[((!IOL.adv.gdpr.consentGoogle)?"true":"false")]}};if(IOL.adv.profile.up.value.isMinor)improveKValue={keyValues:{gam_failover:[((!IOL.adv.gdpr.consentGoogle)?"true":"false")]}};var appnexusKValue={keywords:{'gam_failover':[((!IOL.adv.gdpr.consentGoogle)?"true":"false")],'1plusx':((IOL.adv.profile.enable)?IOL.adv.profile.as.value.s:[]),'ctx1plusx':IOL.adv.profile.as.value.t}};var pbjsHybridCondition=IOL.adv.tools.pbjsHybridCondition();adUnits.forEach(function(adUnit){adUnit.bids.find(IOL.adv.headerBidding.addObjOnBidderParams,{bidder:'improvedigital',kv:improveKValue});adUnit.bids.find(IOL.adv.headerBidding.addObjOnBidderParams,{bidder:'appnexus',kv:appnexusKValue});if(pbjsHybridCondition)IOL.adv.headerBidding.filteringPbjsHybrid(adUnit);});pbjs.setConfig({useBidCache:true});pbjs.setConfig({targetingControls:{addTargetingKeys:['SOURCE','CACHE_ID','ADOMAIN']}});pbjs.bidderSettings={adform:{bidCpmAdjustment:function(bidCpm){return bidCpm*0.88;}},smartx:{bidCpmAdjustment:function(bidCpm){return bidCpm*0.50;}},ias:{alwaysUseBid:true,sendStandardTargeting:false,suppressEmptyKeys:true,adserverTargeting:[{key:'adt',val:function(bidResponse){return bidResponse.adt;}},{key:'alc',val:function(bidResponse){return bidResponse.alc;}},{key:'dlm',val:function(bidResponse){return bidResponse.dlm;}},{key:'drg',val:function(bidResponse){return bidResponse.drg;}},{key:'hat',val:function(bidResponse){return bidResponse.hat;}},{key:'off',val:function(bidResponse){return bidResponse.off;}},{key:'vio',val:function(bidResponse){return bidResponse.vio;}},{key:'fr',val:function(bidResponse){return bidResponse.fr;}},{key:'id',val:function(bidResponse){var match=bidResponse.slots[bidResponse.adUnitCode];return match.id;}},{key:'vw',val:function(bidResponse){var match=bidResponse.slots[bidResponse.adUnitCode];return match.vw;}},{key:'grm',val:function(bidResponse){var match=bidResponse.slots[bidResponse.adUnitCode];return match.grm;}},{key:'pub',val:function(bidResponse){var match=bidResponse.slots[bidResponse.adUnitCode];return match.pub;}},]}};pbjs.setBidderConfig({bidders:['criteo'],config:{ortb2:{user:{ext:{data:{eids:[{source:IOL.adv.hostname,uids:[{id:IOL.adv.getProfile("ppid.zeo"),atype:3,ext:{stype:"hemsha256"}}]}]}}}}}});pbjs.bidderSettings=(pbjs.bidderSettings)?pbjs.bidderSettings:{};pbjs.bidderSettings.standard=(pbjs.bidderSettings.standard)?pbjs.bidderSettings.standard:{};pbjs.bidderSettings.standard.storageAllowed=IOL.adv.deviceAccess.enable
pbjs.que.push(function(){IOL.adv.tools.logger("HeaderBidding prebidjs, Start pbjs.que.push",classFunc);var gdpr={};if(IOL.adv.gdpr.enable){IOL.adv.tools.logger("apply GDPR TCF v2.0",classFunc);gdpr={gdpr:{cmpApi:'iab',timeout:2000,defaultGdprScope:true}};if(IOL.adv.gdpr.tcfv20.pipeline.cmpApi=='static'){IOL.adv.tools.logger("method is static, consentData: "+IOL.adv.gdpr.consentString,classFunc);gdpr={gdpr:{cmpApi:'static',consentData:{getTCData:{tcString:IOL.adv.gdpr.consentString,gdprApplies:true}}}};}}var pd="";if(IOL.adv.headerBidding.supplyChainSid){pbjs.setConfig({schain:{validation:"strict",config:{ver:"1.0",complete:1,nodes:[{asi:"italiaonline.it",sid:IOL.adv.headerBidding.supplyChainSid,hp:1}]}}})}if(IOL.adv.tools.mEnable("liveramp"))if(IOL.adv.settings.modules.liveramp.atsAnalytics)pbjs.enableAnalytics([{provider:"atsAnalytics",options:{pid:"1274"}}]);var userIds=[];if(IOL.adv.deviceAccess.enable){userIds=[{name:"zeotapIdPlus"},{name:'id5Id',params:{partner:522,pd:pd,abTesting:{enabled:false,controlGroupPct:0.1}},storage:{type:'html5',name:'id5id',expires:90,refreshInSeconds:8*3600}},{name:'identityLink',params:{pid:'1274'},storage:{type:'cookie',name:'idl_env',expires:90,refreshInSeconds:900}}];}pbjs.setConfig({enableSendAllBids:true,priceGranularity:IOL.adv.headerBidding.prebidjs.customConfigObject,currency:{"adServerCurrency":"USD"},sizeConfig:IOL.adv.headerBidding.prebidjs.customSizeConfig,deviceAccess:IOL.adv.deviceAccess.enable,userSync:{syncEnabled:IOL.adv.deviceAccess.enable,filterSettings:{iframe:{bidders:'*',filter:'include'}},userIds:userIds},bidderTimeout:IOL.adv.headerBidding.bidderTimeout,rubicon:{singleRequest:true},improvedigital:{usePrebidSizes:true,singleRequest:true},consentManagement:gdpr});pbjs.setConfig({cache:{url:'https://prebid.adnxs.com/pbc/v1/cache'}});pbjs.aliasBidder('smartadserver','smart');adUnits.forEach(function(adUnit){adUnit.bids.forEach(function(bid){if((bid.params.displayFallback)){if(!IOL.adv.gdpr.consentGoogle){IOL.adv.tools.logger(adUnit.code+": displayFallback found for "+bid.bidder+", replace params with: "+JSON.stringify(bid.params.displayFallback),classFunc);bid.params=Object.assign(bid.params,bid.params.displayFallback);}delete bid.params.displayFallback;}});});pbjs.addAdUnits(adUnits);IOL.adv.tools.logger("HeaderBidding prebidjs compliant and initialized.",classFunc);});}else
IOL.adv.tools.logger("HeaderBidding prebidjs: pbjs is not defined or adUnits is empty",classFunc);IOL.adv.tools.logger("HeaderBidding prebidjs enable: "+IOL.adv.headerBidding.prebidjs.enable,classFunc);IOL.adv.headerBidding.bidders.forEach(function(bidder){IOL.adv.headerBidding.requestManager[bidder]=false;});if(IOL.adv.headerBidding.bidders.length>0){IOL.adv.settings.disableInitialLoad=true;IOL.adv.headerBidding.enable=true;}else{IOL.adv.headerBidding.enable=false;IOL.adv.settings.disableInitialLoad=false;}IOL.adv.tools.logger("HeaderBidding enable: "+IOL.adv.headerBidding.enable,classFunc);if(callback)callback();if(fallback)fallback();IOL.adv.tools.logger("End function",classFunc);},run:function(callback){var classFunc=IOL.adv.headerBidding.classname+".run";IOL.adv.tools.logger("Start function",classFunc);disablePrebidDisplayFallback=(IOL.adv.settings.disablePrebidDisplayFallback)?IOL.adv.settings.disablePrebidDisplayFallback:false;IOL.adv.displayEngine.prebid=!IOL.adv.gdpr.consentGoogle&&IOL.adv.headerBidding.prebidjs.enable&&!disablePrebidDisplayFallback;IOL.adv.displayEngine.gpt=!(IOL.adv.displayEngine.prebid||IOL.adv.displayEngine.mgid||IOL.adv.displayEngine.ketai);if(!IOL.adv.headerBidding.enable){IOL.adv.tools.logger("HeaderBidding disabled",classFunc);if(callback)callback();return;}IOL.adv.headerBidding.fetchBids(callback);IOL.adv.headerBidding.requestManager.timer=window.setTimeout(function(){IOL.adv.headerBidding.sendAdserverRequest(function(){IOL.adv.headerBidding.adServerRequestTimedOut(callback)});},IOL.adv.headerBidding.hbTimeout);IOL.adv.tools.logger("End function",classFunc);},fetchBids:function(callback){var classFunc=IOL.adv.headerBidding.classname+".fetchBids";IOL.adv.tools.trkPerf("iamHBStart",Math.floor(performance.now()));IOL.adv.tools.track({e:"time.hbStart",t:Math.floor(performance.now()),lv:"info"});if(IOL.adv.headerBidding.amazon.enable){IOL.adv.tools.logger("Start fetch bids for amazon.",classFunc);apstag.fetchBids({slots:IOL.adv.headerBidding.amazon.slots,timeout:IOL.adv.headerBidding.bidderTimeout},function(bids){IOL.adv.tools.logger("amazon response: "+JSON.stringify(bids),classFunc);IOL.adv.headerBidding.amazon.bids=bids;IOL.adv.headerBidding.headerBidderBack(IOL.adv.headerBidding.amazon.id,callback);});}else
IOL.adv.tools.logger("amazon is disable.",classFunc);if(IOL.adv.headerBidding.prebidjs.enable){IOL.adv.tools.logger("Start fetch bids for pbjs :: adUnit: "+JSON.stringify(pbjs.adUnits),classFunc);pbjs.requestBids({bidsBackHandler:function(bids){IOL.adv.tools.logger("pbjs response: "+JSON.stringify(bids),classFunc);IOL.adv.headerBidding.headerBidderBack(IOL.adv.headerBidding.prebidjs.id,callback);},timeout:IOL.adv.headerBidding.bidderTimeout});}else
IOL.adv.tools.logger("pbjs is disable.",classFunc);},adServerRequestTimedOut:function(callback){var classFunc=IOL.adv.headerBidding.classname+".adServerRequestTimedOut";if(IOL.adv.headerBidding.requestManager.timer!==false){IOL.adv.headerBidding.requestManager.timedOut=true;IOL.adv.tools.trkPerf("iamHBtimeout",Math.floor(performance.now()));IOL.adv.tools.track({e:"time.hbTimeout",t:Math.floor(performance.now()),lv:"warning"});}IOL.adv.tools.logger("requestManager.timedOut: "+IOL.adv.headerBidding.requestManager.timedOut,classFunc);try{if(callback){IOL.adv.tools.logger("Run callback in adServerRequestTimedOut "+callback,classFunc);callback();}if(typeof IamCallbackOnComplete==="function"){IOL.adv.tools.logger("Hook IamCallbackOnComplete",classFunc);IamCallbackOnComplete();}}catch(e){}},sendAdserverRequest:function(callback){var classFunc=IOL.adv.headerBidding.classname+".sendAdserverRequest";IOL.adv.tools.logger("Start function",classFunc);if(IOL.adv.headerBidding.requestManager.adServerRequestSent===true){IOL.adv.tools.logger("Request has been already sent",classFunc);return;}IOL.adv.headerBidding.requestManager.adServerRequestSent=true;clearTimeout(IOL.adv.headerBidding.requestManager.timer);IOL.adv.tools.logger("Request has not been sent, start adServerRequest push",classFunc);if(IOL.adv.headerBidding.prebidjs.enable)if(Object.keys(pbjs.getBidResponses()).length>0&&!IOL.adv.profile.up.value.isMinor)IOL.adv.headerBidding.prebidjs.bids=true;IOL.adv.tools.trkPerf("iamHBend",Math.floor(performance.now()));IOL.adv.tools.track({e:"time.hbEnd",key:"time.hbEnd."+((IOL.adv.headerBidding.prebidjs.bids)?"bids":"nobids"),t:Math.floor(performance.now()),lv:"info"});if(!IOL.adv.profile.up.value.isMinor){if(IOL.adv.headerBidding.amazon.enable){var videoBids=IOL.adv.headerBidding.amazon.bids.filter(function(bid){return bid.mediaType==='video';});if(videoBids.length>0){IOL.adv.tools.logger("set targeting for amazon video",classFunc);videoBids.forEach(function(videoBid){if(videoBid.hasOwnProperty('helpers'))if(videoBid.helpers.hasOwnProperty('encodedQsParams'))IOL.adv.headerBidding.setAmazonVideoBid(videoBid.helpers.encodedQsParams());})}if(IOL.adv.headerBidding.amazon.slotsDisplay.length>0)googletag.cmd.push(function(){IOL.adv.tools.logger("set targeting for amazon",classFunc);apstag.setDisplayBids();});}if(IOL.adv.headerBidding.prebidjs.enable){googletag.cmd.push(function(){pbjs.que.push(function(){IOL.adv.tools.logger("set targeting for pbjs",classFunc);pbjs.setTargetingForGPTAsync();});});}}else
IOL.adv.tools.logger("hb targeting discarded",classFunc);if(IOL.adv.headerBidding.pipeline=="video"){IOL.adv.tools.logger("HeaderBidding in videoOnly mode, skip the display strategy, callback: "+callback,classFunc);IOL.adv.complete=true;try{if(typeof IamCallbackOnComplete==="function"){IOL.adv.tools.logger("Hook IamCallbackOnComplete in sendAdserverRequest",classFunc);IamCallbackOnComplete();}}catch(e){}return;}switch(IOL.adv.mode){case'refresh':IOL.adv.tools.logger("Ads start displayAds after headerBidding in refreshMode",classFunc);IOL.adv.tools.displayAds({slotContainer:IOL.adv.manager.refreshSlotsContainer.slots});break;default:if(IOL.adv.pubAdsCfg.lazy){IOL.adv.tools.logger("Start Lazy loading after header bidding",classFunc);var unLazySlotsContainer=[];Object.keys(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads).forEach(function(id){var ad=IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id];if(ad.mediaType=='display'){if(ad.lazy){IOL.adv.tools.logger(ad.divId+", lazy enabled for this ads, start intersectionObserver",classFunc);var d=IOL.adv.tools.divIdReady(ad,true);if(d){IOL.adv.settings.lazy.observer.obj.observe(d);IOL.adv.settings.lazy.divIdSlotIdMap[ad.divId]=id;}}else{IOL.adv.tools.logger(ad.divId+", lazy disable for this ads, add to unLazySlotsContainer",classFunc);unLazySlotsContainer.push(IOL.adv.manager.slotsContainer[id]);}}});if(unLazySlotsContainer.length>0){IOL.adv.tools.logger("start display the unLazySlotsContainer",classFunc);IOL.adv.tools.displayAds({slotContainer:unLazySlotsContainer});if(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads.admputop)IOL.adv.tools.trkPerf("iamRenderingStartMpuTop",Math.floor(performance.now()));}}else{IOL.adv.tools.logger("displayAds after headerBidding",classFunc);if(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads.admputop)IOL.adv.tools.trkPerf("iamRenderingStartMpuTop",Math.floor(performance.now()));IOL.adv.tools.displayAds();}}window.aax=window.aax||{};window.aax.cmd=window.aax.cmd||[];window.aax.cmd.push(function(){if(window.aax.getAbpStatus()){window.googletag=window.googletag||{};window.googletag.cmd=window.googletag.cmd||[];window.googletag.cmd.push(function(){googletag.pubads().refresh();});}});if(callback){IOL.adv.tools.logger("Run callback: "+callback,classFunc);callback();}if(typeof IamCallbackOnComplete==="function"){IOL.adv.tools.logger("Hook IamCallbackOnComplete in sendAdserverRequest",classFunc);IamCallbackOnComplete();}IOL.adv.tools.logger("End function",classFunc);},allBiddersBack:function(){var classFunc=IOL.adv.headerBidding.classname+".allBiddersBack";var allBiddersBack=IOL.adv.headerBidding.bidders.map(function(bidder){return IOL.adv.headerBidding.requestManager[bidder];}).filter(Boolean).length===IOL.adv.headerBidding.bidders.length;return allBiddersBack;},headerBidderBack:function(bidder,callback){var classFunc=IOL.adv.headerBidding.classname+".headerBidderBack";if(IOL.adv.headerBidding.requestManager.adServerRequestSent===true){return;}IOL.adv.headerBidding.requestManager[bidder]=true;IOL.adv.tools.logger("HeaderBidding requestManager: "+JSON.stringify(IOL.adv.headerBidding.requestManager),classFunc);if(IOL.adv.headerBidding.allBiddersBack()){IOL.adv.tools.logger("HeaderBidding allBiddersBack requestManager: "+JSON.stringify(IOL.adv.headerBidding.requestManager),classFunc);IOL.adv.headerBidding.sendAdserverRequest(callback);}},addObjOnBidderParams:function(e){var classFunc=IOL.adv.headerBidding.classname+".addObjOnBidderParams";try{if((e.bidder===this.bidder)&&this.kv){IOL.adv.tools.logger(this.bidder+" code found, add keyValues: "+JSON.stringify(this.kv),classFunc);e.params=Object.assign(e.params,this.kv);}}catch(err){return false;}},replaceAdunitByCode:function(e){var classFunc=IOL.adv.headerBidding.classname+".replaceAdunitByCode";try{if(e.code===this.code){e.code=this.newcode;IOL.adv.tools.logger(this.code+" code found, replace prebid adUnit code",classFunc);}else{IOL.adv.tools.logger(this.code+" code does not match "+e.code,classFunc);}}catch(err){return false;}},cloneAdunitByCode:function(e){var classFunc=IOL.adv.headerBidding.classname+".cloneAdunitByCode";try{if(e.code===this.code){var adUnit=Object.assign({},e);adUnit.code=this.newcode;IOL.adv.settings.prebidjs.adUnits.push(adUnit)
IOL.adv.tools.logger(this.code+" code found, prebid adUnit cloned",classFunc);}else{IOL.adv.tools.logger(this.code+" code does not match "+e.code,classFunc);}}catch(err){return false;}},setAdunitPathByBidderCode:function(e){var classFunc=IOL.adv.headerBidding.classname+".setAdunitPathByBidderCode";try{IOL.adv.tools.logger("Managing code: "+e.code+", try to find bidder: "+this.bidder,classFunc);e.bids.forEach(function(v){IOL.adv.tools.logger("Compare bidder ["+v.bidder+"] with ["+this.bidder+"]",classFunc);if(v.bidder==this.bidder){v.params.adUnitPath=this.adUnitPath;IOL.adv.tools.logger(this.bidder+" bidder found, set "+v.params.adUnitPath+" as adUnitPath on "+this.code,classFunc);}else{IOL.adv.tools.logger(v.bidder+" bidder does not match "+this.bidder,classFunc);}},{bidder:this.bidder,adUnitPath:this.adUnitPath,code:e.code});}catch(err){return false;}},rmAdunitByCode:function(e){var classFunc=IOL.adv.headerBidding.classname+".rmAdunitByCode";try{if(e.code===this.code){IOL.adv.tools.logger(this.code+" code found, remove item from prebid adUnit",classFunc);return false;}else{IOL.adv.tools.logger(this.code+" code does not match "+e.code,classFunc);return true;}}catch(err){return true;}},getAdunitByCode:function(e){var classFunc=IOL.adv.headerBidding.classname+".getAdunitByCode";try{if(e.code===this.code){IOL.adv.tools.logger(this.code+" code found, remove item from prebid adUnit",classFunc);return true;}else{IOL.adv.tools.logger(this.code+" code does not match "+e.code,classFunc);}}catch(err){return true;}},findAdunitByMediaType:function(e){var classFunc=IOL.adv.headerBidding.classname+".findAdunitByMediaType";try{if(e.mediaTypes[this.mediaType]){IOL.adv.tools.logger(this.mediaType+" adunit found",classFunc);return true;}else{IOL.adv.tools.logger(this.mediaType+" adunit not found",classFunc);return false;}}catch(err){return false;}},apstagInit:function(){var classFunc=IOL.adv.headerBidding.classname+".apstagInit";if(!IOL.adv.headerBidding.amazon.init){IOL.adv.headerBidding.amazon.init=true;var nodes=(IOL.adv.headerBidding.supplyChainSid)?[{asi:'italiaonline.it',sid:IOL.adv.headerBidding.supplyChainSid,hp:1}]:[];apstag.init({pubID:IOL.adv.headerBidding.amazon.pubID,adServer:IOL.adv.headerBidding.amazon.adServer,videoAdServer:IOL.adv.headerBidding.amazon.videoAdServer,deals:IOL.adv.headerBidding.amazon.deals,useSafeFrames:IOL.adv.settings.hasOwnProperty("amazonUseSafeFrames")?IOL.adv.settings.amazonUseSafeFrames:false,gdpr:{enabled:IOL.adv.gdpr.enable,consent:IOL.adv.gdpr.consentString},schain:{complete:1,ver:'1.0',nodes:nodes}});IOL.adv.tools.logger("apstag init done",classFunc);}else
IOL.adv.tools.logger("apstag init already done",classFunc);},isEnable:function(){var classFunc=IOL.adv.headerBidding.classname+".isEnable";IOL.adv.tools.logger("return: "+IOL.adv.headerBidding.enable,classFunc);return IOL.adv.headerBidding.enable;},isAmazonEnable:function(){var classFunc=IOL.adv.headerBidding.classname+".isAmazonEnable";IOL.adv.tools.logger("return: "+IOL.adv.headerBidding.amazon.enable,classFunc);return IOL.adv.headerBidding.amazon.enable;},isPrebidJsEnable:function(){var classFunc=IOL.adv.headerBidding.classname+".isPrebidJsEnable";IOL.adv.tools.logger("return: "+IOL.adv.headerBidding.prebidjs.enable,classFunc);return IOL.adv.headerBidding.prebidjs.enable;},getAmazonVideoBid:function(){var classFunc=IOL.adv.headerBidding.classname+".getAmazonVideoBid";IOL.adv.tools.logger("return videoBid:"+IOL.adv.headerBidding.amazon.videoBid,classFunc);return IOL.adv.headerBidding.amazon.videoBid;},setAmazonVideoBid:function(v){var classFunc=IOL.adv.headerBidding.classname+".setAmazonVideoBid";IOL.adv.headerBidding.amazon.videoBid+=v;IOL.adv.tools.logger("videoBid:"+IOL.adv.headerBidding.amazon.videoBid,classFunc);},filteringPbjsHybrid:function(ad){var classFunc=IOL.adv.headerBidding.classname+".filteringPbjsHybrid";var adUnit=ad;var filter=(typeof IOL.adv.settings.pbjsHybrid==="boolean")?{display:['appnexus','criteo','pubmatic'],videoInstream:['appnexus','criteo','pubmatic','freewheel-ssp','smartadserver']}:IOL.adv.settings.pbjsHybrid;var pbjsHybrid=false;switch(Object.keys(adUnit.mediaTypes)[0]){case'video':if(adUnit.mediaTypes.video.context==='instream')pbjsHybrid=filter.hasOwnProperty("videoInstream")?filter.videoInstream:false;else if(adUnit.mediaTypes.video.context==='outstream')pbjsHybrid=filter.hasOwnProperty("videoOutstream")?filter.videoOutstream:false;break;case'native':pbjsHybrid=filter.hasOwnProperty("native")?filter.native:false;break;case'banner':default:pbjsHybrid=filter.hasOwnProperty("display")?filter.display:false;}IOL.adv.tools.logger("pbjsHybrid filtering - mediaTypes:"+Object.keys(adUnit.mediaTypes)[0]+((Object.keys(adUnit.mediaTypes)[0]==="video")?"("+adUnit.mediaTypes.video.context+")":"")+", adunit:"+adUnit.code+", bidders:"+pbjsHybrid.join(","),classFunc);if(pbjsHybrid){adUnit.bids=adUnit.bids.filter(function(bid){return pbjsHybrid.includes(bid.bidder);})}}}}if(typeof IOL.adv!='undefined'){try{if(!window.iamInitialized){window.iamInitialized=true;if(!window.pubAdsCfg)window.pubAdsCfg={};IOL.adv.tools.objAssigner(IOL.adv.pubAdsCfg,window.pubAdsCfg);IOL.adv.tools.debugInit();IOL.adv.debug.tracking.attr.push('iam'+IOL.adv.version);IOL.adv.tools.trkPerf("iamInjection",Math.floor(performance.now()));IOL.adv.tools.track({e:"time.injection",t:Math.floor(performance.now()),lv:"info"});if(typeof IOL.adv.settings.abtest=='function')IOL.adv.settings.abtest();if(IOL.adv.tools.mEnable("aax"))(function(){window.aax=window.aax||{};var aax=window.aax;aax.initTime=new Date().getTime();aax.pubId="AAXHTOHT6";aax.ver="1.2";aax.hst=window.location.hostname;var aaxEndpoint="https://c.aaxads.com/aax.js?pub="+aax.pubId+"&hst="+aax.hst+"&ver="+aax.ver;function loadScript(endpoint){var scriptTag=document.createElement("script"),placeTag=document.getElementsByTagName("script")[0];scriptTag.type="text/javascript";scriptTag.async=true;scriptTag.src=endpoint;placeTag.parentNode.insertBefore(scriptTag,placeTag);}loadScript(aaxEndpoint);})();if(IOL.adv.tools.mEnable("antiAdBlock")){function createElement(a){var tmp=document.createElement('script');tmp.type='text/javascript';tmp.setAttribute("nonce","hsf0pBuBryPFoQqOj0RBNg");if(a.hasOwnProperty("src")){tmp.src=a.src;tmp.async=true;}if(a.hasOwnProperty("innerHTML"))tmp.innerHTML=a.innerHTML;var h=document.getElementsByTagName("head")[0];h.parentNode.insertBefore(tmp,h);}createElement({src:"https://fundingchoicesmessages.google.com/i/pub-2033535132705533?ers=1"});createElement({innerHTML:"(function() {function signalGooglefcPresent() {if (!window.frames['googlefcPresent']) {if (document.body) {const iframe = document.createElement('iframe'); iframe.style = 'width: 0; height: 0; border: none; z-index: -1000; left: -1000px; top: -1000px;'; iframe.style.display = 'none'; iframe.name = 'googlefcPresent'; document.body.appendChild(iframe);} else {setTimeout(signalGooglefcPresent, 0);}}}signalGooglefcPresent();})();"});}if(IOL.adv.pubAdsCfg.deferredRun){IOL.adv.pubAdsCfg.deferredDivId=false;IOL.adv.pubAdsCfg.deferredDisplay=true;}IOL.adv.tools.logger("start loading 3rd party library","iam");Object.keys(IOL.adv.settings.library).forEach(function(key){if(!IOL.adv.settings.library[key].hasOwnProperty("gdpr"))IOL.adv.tools.inject(IOL.adv.settings.library[key]);});if(IOL.adv.pubAdsCfg.deferredDivId)IOL.adv.manager.deferredTimer=setInterval(function(){IOL.adv.tools.deferredDivIdReady(function(){IOL.adv.start()});},IOL.adv.manager.deferredInterval);else
IOL.adv.start();window.addEventListener('beforeunload',function(event){IOL.adv.tools.trkPerf("iamPageUnloadAdvComplete"+((IOL.adv.complete)?'True':'False'),Math.floor(performance.now()),!IOL.adv.complete);IOL.adv.tools.track({e:"pageUnload",t:Math.floor(performance.now()),lv:"info"});});}else
IOL.adv.tools.logger("IAM has been already initialized","IOL.adv");}catch(e){IOL.adv.tools.logger("Error "+e.message,"iam","error");}}